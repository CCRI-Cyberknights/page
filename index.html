<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CCRI Cyberknights Club</title>
  <meta name="description" content="A centralized hub for the CCRI Cybersecurity Club. Find information about when and where to find the Cyberknights, and much more!">
  <meta property="og:title" content="CCRI Cyberknights Club">
  <meta property="og:description" content="A centralized hub for the CCRI Cybersecurity Club. Find information about when and where to find the Cyberknights, and much more!">
  <meta property="og:image" content="https://ccri-cyberknights.github.io/page/cybersmith.webp">
  <link rel="icon" href="favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="./qrcode.min.js"></script>
  <style>
    :root { color-scheme: dark; }
    /* Spark glow animation for Sign Up button */
    .btn-sparkle {
      position: relative;
      background-image: linear-gradient(90deg, rgba(34,197,94,0.10), rgba(245,158,11,0.10));
      box-shadow: 0 0 0 rgba(34,197,94,0);
      animation: sparkPulse 2.4s ease-in-out infinite;
      transition: transform 150ms ease, box-shadow 150ms ease;
    }
    .btn-sparkle:hover { transform: translateY(-1px); }
    @keyframes sparkPulse {
      0%, 100% {
        box-shadow: 0 0 8px 0 rgba(34,197,94,0.25), 0 0 0 0 rgba(245,158,11,0.0);
        border-color: #22c55e;
      }
      50% {
        box-shadow: 0 0 14px 6px rgba(245,158,11,0.35), 0 0 28px 10px rgba(34,197,94,0.30);
        border-color: #f59e0b;
      }
    }
    @media (prefers-reduced-motion: reduce) {
      .btn-sparkle { animation: none; }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
  <div class="w-full bg-[#22c55e] text-white text-xs tracking-wide">
    <div class="max-w-5xl mx-auto px-4 py-2 flex flex-wrap items-center justify-center gap-3 text-center">
      <span class="font-semibold">Excitement</span>
      <span>‚Ä¢</span>
      <span class="font-semibold">Opportunity</span>
      <span>‚Ä¢</span>
      <span class="font-semibold">Belonging</span>
    </div>
  </div>
  <header class="max-w-5xl mx-auto px-4 py-6">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="cybersmith.webp" alt="CyberKnights" class="w-10 h-10 rounded" />
        <h1 class="text-xl font-semibold tracking-tight">CCRI Cybersecurity Club</h1>
      </div>
      <nav class="flex gap-4 text-sm">
        <a href="#/home" class="hover:text-emerald-300">Home</a>
        <a href="#/cybersecurity" class="hover:text-emerald-300">Club</a>
        <a href="#/linux" class="hover:text-emerald-300">Linux Guide</a>
        <a href="#/calendar" class="hover:text-emerald-300">Calendar</a>
        <a href="#/resources" class="hover:text-emerald-300">Resources</a>
      </nav>
  </header>

  <main id="app" class="max-w-5xl mx-auto px-4 pb-24"></main>

  <footer class="border-t border-slate-800/60 mt-16">
    <div class="max-w-5xl mx-auto px-4 py-6 text-xs text-slate-400 flex items-center justify-between">
      <div>
        ¬© <span id="year"></span> CCRI Cybersecurity Club
      </div>
      <div class="relative">
        <button id="footer-qr-toggle" class="hover:text-emerald-300">QR Code</button>
        <div id="footer-qr-panel" class="hidden absolute right-0 bottom-8 p-4 rounded-lg border border-slate-800 bg-slate-900/95 shadow-lg w-[500px] sm:w-[500px] max-w-[90vw]">
          <div class="space-y-2">
            <div>
              <input id="footer-qr-input" type="text" placeholder="Enter text or URL" class="w-full px-2 py-1 rounded bg-slate-800 border border-slate-700 outline-none focus:border-emerald-500 text-slate-200" />
            </div>
            <div class="rounded border border-slate-800 bg-slate-900/60 p-2 text-[11px] text-slate-400">
              <div class="flex justify-between">
                <span>Defaults to this page‚Äôs URL</span>
                <span id="footer-qr-length" class="ml-4 text-right">Length: 0</span>
              </div>
              <div class="mt-1">Edit to generate any QR</div>
            </div>
            <div class="space-y-3">
              <div class="rounded border border-slate-800 bg-slate-900/60 p-2">
                <div class="flex flex-wrap items-center justify-between gap-2 text-[11px] text-slate-400">
                  <div id="footer-qr-info"></div>
                  <div class="flex items-center gap-1">
                    <span class="mr-1">Error Correction Level (ECL):</span>
                    <button id="footer-qr-ecl-dec" class="px-1 py-0.5 rounded border border-slate-700 hover:border-slate-600" title="Lower error correction">‚àí</button>
                    <span id="footer-qr-ecl" class="min-w-[1.5ch] text-slate-200 text-xs text-center">M</span>
                    <button id="footer-qr-ecl-inc" class="px-1 py-0.5 rounded border border-slate-700 hover:border-slate-600" title="Raise error correction">+</button>
                  </div>
                </div>
              </div>
              <div class="flex justify-center">
                <div class="p-8 rounded border border-slate-800 bg-slate-900/60 inline-block">
                  <canvas id="footer-qr-canvas" class="bg-white p-1 rounded" width="160" height="160"></canvas>
                  <img id="footer-qr-img" alt="QR code" class="hidden bg-white p-1 rounded" width="160" height="160" />
                </div>
              </div>
              <div class="flex justify-center">
                <button id="footer-qr-download" class="px-3 py-1 rounded border border-slate-700 hover:border-slate-600">Download PNG</button>
              </div>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <template id="page-home">
    <!-- Hero Section -->
    <section class="mb-12 p-6 rounded-lg border border-emerald-500/40 bg-gradient-to-r from-emerald-900/20 to-blue-900/20">
      <div class="text-center space-y-4">
        <h1 class="text-2xl sm:text-3xl font-bold text-emerald-300">
          We've Moved to a Bigger Venue!
        </h1>
        <p class="text-slate-300 max-w-2xl mx-auto">
          Thanks to overwhelming interest, we've outgrown our old room. Join us in our new home, the Auditorium (Room 4080).
        </p>
        <div class="pt-2">
          <a href="#/map-warwick-4080" class="inline-flex items-center px-6 py-3 rounded-lg bg-emerald-500 text-slate-900 font-semibold hover:bg-emerald-400 transition-colors">
            Find Our New Location
            <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
          </a>
        </div>
      </div>
    </section>

    <section class="grid lg:grid-cols-2 items-center gap-10 pt-4">
      <div class="space-y-6">
        <h2 class="text-3xl sm:text-4xl font-bold leading-tight">
          CyberKnights at CCRI
        </h2>
        <p class="text-slate-300">
          We're a student community learning cybersecurity through hands-on workshops, labs, and projects. 
          Join us for game nights, competitions, and practical learning experiences.
        </p>
        <div class="flex flex-wrap gap-3">
          <a href="#/cybersecurity" class="px-4 py-2 rounded bg-emerald-500 text-slate-900 font-medium hover:bg-emerald-400">Join the Club</a>
          <a href="#/resources" class="px-4 py-2 rounded border border-slate-700 hover:border-slate-600">Explore Resources</a>
        </div>
      </div>
      <div class="flex justify-center">
        <img src="cybersmith.webp" alt="CyberKnights" class="w-72 h-72 object-contain drop-shadow-[0_0_40px_rgba(16,185,129,0.25)]" />
      </div>
    </section>

    <section class="mt-12">
      <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40">
        <h3 class="text-lg font-semibold mb-3">Our Mission</h3>
        <p class="text-slate-300 mb-4">
          Building a thriving cybersecurity community at CCRI through:
        </p>
        <ul class="text-slate-300 space-y-2 text-sm">
          <li class="flex items-start">
            <span class="font-semibold text-white mr-2">‚Ä¢</span>
            <span>Hands-on projects with Raspberry Pi kits and 3D printing</span>
          </li>
          <li class="flex items-start">
            <span class="font-semibold text-white mr-2">‚Ä¢</span>
            <span>Game nights and social events for all skill levels</span>
          </li>
          <li class="flex items-start">
            <span class="font-semibold text-white mr-2">‚Ä¢</span>
            <span>Practical workshops beyond traditional lectures</span>
          </li>
          <li class="flex items-start">
            <span class="font-semibold text-white mr-2">‚Ä¢</span>
            <span>Welcoming environment fostering <span class="font-semibold text-white">Excitement</span>, <span class="font-semibold text-white">Opportunity</span>, and <span class="font-semibold text-white">Belonging</span></span>
          </li>
        </ul>
      </div>
    </section>
  </template>

  

  <template id="page-cybersecurity">
    <section class="grid lg:grid-cols-2 items-center gap-10 pt-4">
      <div class="space-y-6">
        <h2 class="text-3xl sm:text-4xl font-bold leading-tight">
          Welcome to the Cybersecurity Club
        </h2>
        <p class="text-slate-300">
          Learn, build, and compete with peers. Join workshops, talks, and
          hands-on labs covering security fundamentals through advanced topics.
        </p>
        <div class="p-3 rounded border border-emerald-700/40 bg-emerald-900/10 text-emerald-200 text-sm">
          See our upcoming events and meetings on the <a href="#/calendar" class="underline hover:text-emerald-300">Club Calendar</a>.
        </div>
        <div class="flex flex-wrap gap-3">
          <a href="https://www.ccri.edu/comp/cybersecurity/studentclub.html" target="_blank" rel="noopener noreferrer" class="px-4 py-2 rounded border border-[#22c55e] text-[#22c55e] hover:bg-[#22c55e]/10">
            CCRI Cybersecurity Club Student Site
          </a>
          <a href="https://forms.cloud.microsoft/r/U26WUVJGgp" target="_blank" rel="noopener noreferrer" class="px-4 py-2 rounded border border-[#22c55e] text-[#22c55e] hover:bg-[#22c55e]/10 btn-sparkle">
            Sign Up
          </a>
          <a href="#/resources" class="px-3 py-1.5 rounded border border-slate-800 text-slate-300 hover:text-emerald-300 text-sm">View Resources</a>
        </div>
      </div>
      <div class="flex justify-center">
        <img src="cyberknight-welder.webp" alt="CyberKnights" class="w-72 h-72 object-contain drop-shadow-[0_0_40px_rgba(16,185,129,0.25)]" />
      </div>
    </section>

    <section class="mt-12 grid sm:grid-cols-2 gap-6">
      <div class="p-5 rounded-lg border border-slate-800 bg-slate-900/40">
        <h3 class="font-semibold mb-2">What we do</h3>
        <p class="text-slate-300 text-sm">Workshops, Linux hardening, CTFs, mentoring, and community.</p>
        <div class="mt-3 flex flex-wrap gap-2 text-xs">
          <a href="#/resources/ctf-tools" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CTF Tools</a>
          <a href="#/resources/code-breaking" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Code Breaking</a>
          <a href="#/resources/ctf-competitions" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CTF Competitions</a>
          <a href="#/resources/ccri" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CCRI & Certs</a>
          <a href="#/resources/cyberknights" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Community</a>
        </div>
      </div>
      <div class="p-5 rounded-lg border border-slate-800 bg-slate-900/40">
        <h3 class="font-semibold mb-2">Get involved</h3>
        <p class="text-slate-300 text-sm">Join our meetings, Discord, and events throughout the semester.</p>
        <div class="mt-3 flex flex-wrap gap-2 text-xs">
          <a href="#/resources/ctf-competitions" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Competitions</a>
          <a href="#/resources/cyberknights" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CyberKnights</a>
          <a href="#/resources/stem" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">STEM Day</a>
          <a href="#/resources" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">All Resources</a>
        </div>
      </div>
    </section>
  </template>

  <template id="page-linux">
    <section class="space-y-6">
      <h2 class="text-3xl sm:text-4xl font-bold">CyberKnights Linux: USB Boot Guide</h2>
      <p class="text-slate-300">Follow these steps to boot from a USB drive.</p>

      <ol class="list-decimal list-inside space-y-2 text-slate-200">
        <li>Shut down your computer.</li>
        <li>Insert the prepared USB drive.</li>
        <li>Power on and repeatedly tap your one-time boot menu key (see below) as soon as the logo appears. Keep tapping until the boot menu opens; if you miss it, restart and try again.</li>
        <li>Select the USB device and press Enter.</li>
        <li>Follow on-screen instructions to try or install.</li>
      </ol>
      <p class="mt-2 text-slate-400 text-sm">Tip: Start tapping the key about twice per second right after pressing the power button. This is normal for most brands.</p>

      <div class="mt-6 p-5 rounded-lg border border-slate-800 bg-slate-900/40">
        <h3 class="font-semibold mb-3">Common One-Time Boot Keys</h3>
        <div class="grid sm:grid-cols-2 gap-3 text-sm">
          <div><span class="text-slate-400">Dell</span>: F12</div>
          <div><span class="text-slate-400">HP</span>: Esc, F9</div>
          <div><span class="text-slate-400">Lenovo</span>: F12, Novo Button</div>
          <div><span class="text-slate-400">Acer</span>: F12</div>
          <div><span class="text-slate-400">ASUS</span>: Esc, F8</div>
          <div><span class="text-slate-400">MSI</span>: F11</div>
          <div><span class="text-slate-400">Toshiba</span>: F12</div>
          <div><span class="text-slate-400">Samsung</span>: Esc, F12</div>
        </div>
      </div>

      <div class="mt-6">
        <a href="#/cybersecurity" class="text-emerald-400 hover:text-emerald-300">Back to Club page</a>
        <span class="mx-2">‚Ä¢</span>
        <a href="#/resources" class="text-emerald-400 hover:text-emerald-300">Further reading</a>
      </div>
    </section>
  </template>

  <template id="page-calendar">
    <section class="space-y-6">
      <h2 class="text-3xl sm:text-4xl font-bold">Club Calendar</h2>
      <p class="text-slate-300">Upcoming meetings and events managed via the club Google Calendar.</p>

      <div id="calendar-callout" class="p-4 rounded border border-amber-500/40 bg-amber-900/20 text-amber-200 text-sm"></div>

      <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40">
        <h3 class="text-lg font-semibold mb-4">Meeting Types</h3>
        <p class="text-slate-300 mb-4">We offer a variety of meetings to appeal to a broad range of members.</p>
        <div class="space-y-4">
          <div class="flex items-start">
            <div class="flex-shrink-0 w-3 h-3 rounded-full mt-2 mr-3" style="background-color: #6B8E23;"></div>
            <div>
              <h4 class="font-semibold text-white">Warwick - 'A' meet (Mondays, 5-6pm)</h4>
              <p class="text-slate-300 text-sm">Official, formal meetings for interacting with faculty and discussing college initiatives. <a href="#/map-warwick-4080" class="text-emerald-400 hover:text-emerald-300 underline">Room 4080</a></p>
            </div>
          </div>
          <div class="flex items-start">
            <div class="flex-shrink-0 w-3 h-3 rounded-full mt-2 mr-3" style="background-color: #7C3AED;"></div>
            <div>
              <h4 class="font-semibold text-white">Warwick - 'B' meet (Wednesdays, 5-6pm)</h4>
              <p class="text-slate-300 text-sm">Informal, low-key sessions designed for small group interaction. <a href="#/map-warwick-4080" class="text-emerald-400 hover:text-emerald-300 underline">Room 4080</a></p>
            </div>
          </div>
          <div class="flex items-start">
            <div class="flex-shrink-0 w-3 h-3 rounded-full mt-2 mr-3" style="background-color: #F97316;"></div>
            <div>
              <h4 class="font-semibold text-white">Newport Campus Meeting (Saturdays, 10am-1pm)</h4>
              <p class="text-slate-300 text-sm">Specifically for preparing for cybersecurity competitions like <a href="https://ccri-cyberknights.github.io/page/#/resources/ctf-competitions" class="text-blue-400 hover:text-blue-300 underline">NCL</a> and <a href="https://ccri-cyberknights.github.io/page/#/resources/ctf-competitions" class="text-blue-400 hover:text-blue-300 underline">NCAE</a>.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap gap-3">
        <a id="calendar-add-google" href="#" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 rounded bg-emerald-500 text-slate-900 font-medium hover:bg-emerald-400 text-sm">Add to Google Calendar</a>
        <a id="calendar-subscribe-link" href="#" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 rounded bg-blue-500 text-slate-900 font-medium hover:bg-blue-400 text-sm">Download .ics</a>
      </div>

      <div class="rounded-lg overflow-hidden border border-slate-800 bg-slate-900/40">
        <iframe id="calendar-iframe" src="" title="CCRI Cybersecurity Club Calendar" width="100%" height="800" frameborder="0" scrolling="auto"></iframe>
      </div>

      
    </section>
  </template>

  <template id="page-resources">
    <section class="space-y-6">
      <h2 class="text-3xl sm:text-4xl font-bold">Resources</h2>
      <p class="text-slate-300">Curated tools and links for learning and competitions. Use search to filter; expand the full list if needed.</p>

      <div class="flex flex-wrap gap-2 text-xs">
        <button data-filter="all" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">All</button>
        <button data-filter="code-breaking" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Code Breaking Tools</button>
        <button data-filter="ctf-tools" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CTF Tools</button>
        <button data-filter="ctf-competitions" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CTF Competitions</button>
        <button data-filter="ccri" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CCRI & Certs</button>
        <button data-filter="cyberknights" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Cyberknights</button>
        <button data-filter="stem" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">STEM Day</button>
      </div>

      <div class="relative">
        <input id="resources-search" type="text" placeholder="Search resources‚Ä¶" class="w-full px-3 py-2 rounded bg-slate-800 border border-slate-700 outline-none focus:border-emerald-500 text-slate-200" />
      </div>

      <div id="resources-grid" class="grid sm:grid-cols-2 gap-3"></div>

      <details class="mt-4">
        <summary class="cursor-pointer text-slate-300">Full list (table)</summary>
        <div class="mt-3 overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="text-slate-400">
              <tr><th class="text-left font-medium py-1">Name</th><th class="text-left font-medium py-1">Category</th><th class="text-left font-medium py-1">URL</th></tr>
            </thead>
            <tbody id="resources-table" class="text-slate-200"></tbody>
          </table>
        </div>
      </details>

      <div class="mt-6">
        <a href="#/cybersecurity" class="text-emerald-400 hover:text-emerald-300">Back to Club</a>
      </div>
    </section>
  </template>

  <template id="page-map-warwick-4080">
    <section class="space-y-6">
      <h2 class="text-3xl sm:text-4xl font-bold">Campus Map - Room 4080</h2>
      <p class="text-slate-300">Find our new meeting location in the Auditorium (Room 4080).</p>
      
      <div class="rounded-lg overflow-hidden border border-slate-800 bg-slate-900/40">
        <img src="map-rm4080-optimized.webp" alt="Campus Map showing Room 4080 location" class="w-full h-auto" />
      </div>
      
      <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40">
        <h3 class="text-lg font-semibold mb-4">Meeting Location Details</h3>
        <div class="space-y-3 text-slate-300">
          <div class="flex items-start">
            <span class="font-semibold text-white mr-2">üìç</span>
            <div>
              <div class="font-medium">Auditorium (Room 4080)</div>
              <div class="text-sm text-slate-400">CCRI Warwick Campus</div>
            </div>
          </div>
          <div class="flex items-start">
            <span class="font-semibold text-white mr-2">üïí</span>
            <div>
              <div class="font-medium">Meeting Times</div>
              <div class="text-sm text-slate-400">Mondays 5-6pm ('A' meet), Wednesdays 5-6pm ('B' meet) </div>
            </div>
          </div>
          <div class="flex items-start">
            <span class="font-semibold text-white mr-2">‚ÑπÔ∏è</span>
            <div>
              <div class="font-medium">Note</div>
              <div class="text-sm text-slate-400">We've moved to this larger space due to increased interest in our club activities.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6">
        <a href="#/calendar" class="text-emerald-400 hover:text-emerald-300">‚Üê Back to Calendar</a>
      </div>
    </section>
  </template>

  <script>
    const CALENDAR_EMBED_URL = "https://calendar.google.com/calendar/embed?src=Y2NyaWN5YmVya25pZ2h0Y2x1YkBnbWFpbC5jb20&ctz=America/New_York"; // Optional: Google Calendar embed URL
    const CALENDAR_ICS_URL = "https://calendar.google.com/calendar/ical/Y2NyaWN5YmVya25pZ2h0Y2x1YkBnbWFpbC5jb20/public/basic.ics";    // Public Google Calendar ICS URL
    const DOCS_CALENDAR_URL = "https://github.com/CCRI-Cyberknights/page/blob/main/docs/CALENDAR-UPDATING.md";
    const ENABLE_CUSTOM_CALENDAR = false; // Set to true to use ICS-powered list + FullCalendar
    let fcInstance = null;

    const routes = {
      home: document.getElementById('page-home').innerHTML,
      cybersecurity: document.getElementById('page-cybersecurity').innerHTML,
      linux: document.getElementById('page-linux').innerHTML,
      calendar: document.getElementById('page-calendar').innerHTML,
      resources: document.getElementById('page-resources') ? document.getElementById('page-resources').innerHTML : '<section class="space-y-6"><h2 class="text-3xl sm:text-4xl font-bold">Resources</h2><p class="text-slate-300">Coming soon.</p></section>',
      'map-warwick-4080': document.getElementById('page-map-warwick-4080').innerHTML
    };

    function normalizeHashRouting() {
      // If old query-param links like ?page=calendar are used, rewrite to #/calendar
      const params = new URLSearchParams(window.location.search);
      const legacy = params.get('page');
      if (legacy && !window.location.hash) {
        const clean = window.location.pathname + '#/' + legacy;
        history.replaceState(null, '', clean);
      }
    }

    function render() {
      const raw = (location.hash || '').replace(/^#\/?/, '');
      const [pageName, ...segments] = raw.split('/');
      const page = pageName || 'home';
      const html = routes[page] || routes.cybersecurity;
      document.getElementById('app').innerHTML = html;
      // Mobile nav removed - using direct navigation
      if (page === 'calendar') {
        const iframe = document.getElementById('calendar-iframe');
        const callout = document.getElementById('calendar-callout');
        const directLink = document.getElementById('calendar-direct-link');
        const subscribeLink = document.getElementById('calendar-subscribe-link');
        const addGoogleLink = document.getElementById('calendar-add-google');
        if (CALENDAR_EMBED_URL && iframe) {
          iframe.src = CALENDAR_EMBED_URL;
          if (callout) callout.style.display = 'none';
          if (directLink) directLink.href = CALENDAR_EMBED_URL;
        }

        // Always show the green "Add to Your Google Calendar" button when an ICS is configured
        if (subscribeLink) {
          if (CALENDAR_ICS_URL) {
            const webcalUrl = CALENDAR_ICS_URL.replace(/^https?:\/\//, 'webcal://');
            subscribeLink.href = webcalUrl;
            subscribeLink.style.display = '';
          } else {
            subscribeLink.style.display = 'none';
          }
        }

        if (addGoogleLink) {
          const calendarId = 'Y2NyaWN5YmVya25pZ2h0Y2x1YkBnbWFpbC5jb20';
          addGoogleLink.href = 'https://calendar.google.com/calendar/u/0/r?cid=' + calendarId;
        }

        if (ENABLE_CUSTOM_CALENDAR && CALENDAR_ICS_URL) {
          fetchAndRenderEvents(CALENDAR_ICS_URL);
          fetchAndRenderFullCalendar(CALENDAR_ICS_URL);
        }

        if (callout) {
          if (!CALENDAR_EMBED_URL || (ENABLE_CUSTOM_CALENDAR && !CALENDAR_ICS_URL)) {
            callout.innerHTML = 'Maintainers: <a href="' + DOCS_CALENDAR_URL + '" target="_blank" rel="noopener noreferrer" class="underline">see docs</a>.';
          } else {
            callout.style.display = 'none';
          }
        }

        

        if (!ENABLE_CUSTOM_CALENDAR) {
          const nextSection = document.getElementById('next-event');
          const upcomingSection = document.getElementById('upcoming-events-section');
          const fc = document.getElementById('fc-container');
          if (nextSection) nextSection.style.display = 'none';
          if (upcomingSection) upcomingSection.style.display = 'none';
          if (fc) fc.style.display = 'none';
        }
      }
      updateFooterQr(page);
      if (page === 'resources') {
        try { renderResourcesPage(segments[0] || 'all'); } catch {}
      }
    }

    function unfoldIcsLines(icsText) {
      const rawLines = icsText.replace(/\r/g, '').split('\n');
      const lines = [];
      for (const line of rawLines) {
        if (!line) continue;
        if (line.startsWith(' ') || line.startsWith('\t')) {
          lines[lines.length - 1] += line.slice(1);
        } else {
          lines.push(line);
        }
      }
      return lines;
    }

    function parseIcsDate(value) {
      // Supports YYYYMMDD and YYYYMMDDTHHMMSSZ or local time without Z
      if (!value) return null;
      const dateOnly = /^\d{8}$/;
      const dateTime = /(\d{8})T(\d{6})(Z?)/;
      if (dateOnly.test(value)) {
        const y = value.slice(0,4), m = value.slice(4,6), d = value.slice(6,8);
        return new Date(`${y}-${m}-${d}T00:00:00`);
      }
      const m = value.match(dateTime);
      if (m) {
        const ymd = m[1];
        const hms = m[2];
        const z = m[3] === 'Z' ? 'Z' : '';
        const y = ymd.slice(0,4), mo = ymd.slice(4,6), d = ymd.slice(6,8);
        const hh = hms.slice(0,2), mm = hms.slice(2,4), ss = hms.slice(4,6);
        return new Date(`${y}-${mo}-${d}T${hh}:${mm}:${ss}${z}`);
      }
      return new Date(value);
    }

    function parseIcs(icsText) {
      const lines = unfoldIcsLines(icsText);
      const events = [];
      let current = null;
      let rrule = null;
      for (const line of lines) {
        if (line === 'BEGIN:VEVENT') { current = {}; rrule = null; continue; }
        if (line === 'END:VEVENT') {
          if (current) {
            if (rrule) current.rrule = rrule;
            events.push(current);
            current = null;
            rrule = null;
          }
          continue;
        }
        if (!current) continue;
        const idx = line.indexOf(':');
        if (idx === -1) continue;
        const nameAndParams = line.slice(0, idx);
        const value = line.slice(idx + 1);
        const prop = nameAndParams.split(';')[0].toUpperCase();
        switch (prop) {
          case 'DTSTART': current.start = parseIcsDate(value); break;
          case 'DTEND': current.end = parseIcsDate(value); break;
          case 'SUMMARY': current.title = value; break;
          case 'DESCRIPTION': current.description = value; break;
          case 'LOCATION': current.location = value; break;
          case 'URL': current.url = value; break;
          case 'RRULE': rrule = value; break;
        }
      }
      return events.filter(e => e.start instanceof Date && !isNaN(e.start));
    }

    function formatDateRange(start, end) {
      const sameDay = end && start.toDateString() === end.toDateString();
      const dateFmt = new Intl.DateTimeFormat(undefined, { weekday: 'short', month: 'short', day: 'numeric' });
      const timeFmt = new Intl.DateTimeFormat(undefined, { hour: 'numeric', minute: '2-digit' });
      const dateStr = dateFmt.format(start);
      if (!end) return `${dateStr} ‚Ä¢ ${timeFmt.format(start)}`;
      if (sameDay) return `${dateStr} ‚Ä¢ ${timeFmt.format(start)} ‚Äì ${timeFmt.format(end)}`;
      return `${dateStr} ${timeFmt.format(start)} ‚Üí ${dateFmt.format(end)} ${timeFmt.format(end)}`;
    }

    function classifyEvent(e) {
      const title = (e.title || '').toLowerCase();
      const isWeekly = e.rrule && /FREQ=WEEKLY/i.test(e.rrule);
      const isRegularByTitle = /(meeting|hang|weekly)/i.test(title);
      return (isWeekly || isRegularByTitle) ? 'regular' : 'special';
    }

    function buildIcsForEvent(e) {
      const pad = (n) => String(n).padStart(2, '0');
      const toIcsDate = (d) => `${d.getUTCFullYear()}${pad(d.getUTCMonth()+1)}${pad(d.getUTCDate())}T${pad(d.getUTCHours())}${pad(d.getUTCMinutes())}${pad(d.getUTCSeconds())}Z`;
      const dtstart = toIcsDate(e.start);
      const dtend = e.end ? toIcsDate(e.end) : toIcsDate(new Date(e.start.getTime() + 60*60*1000));
      const summary = (e.title || 'Event').replace(/\n/g, ' ');
      const description = (e.description || '').replace(/\n/g, ' ');
      const location = (e.location || '').replace(/\n/g, ' ');
      const uid = `${dtstart}-${summary.replace(/[^A-Za-z0-9]+/g,'-')}@ccri-cyberclub`;
      const lines = [
        'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//CCRI Cybersecurity Club//EN','BEGIN:VEVENT',
        `UID:${uid}`,`DTSTAMP:${toIcsDate(new Date())}`,`DTSTART:${dtstart}`,`DTEND:${dtend}`,
        `SUMMARY:${summary}`, description ? `DESCRIPTION:${description}` : '', location ? `LOCATION:${location}` : '', 'END:VEVENT','END:VCALENDAR'
      ].filter(Boolean);
      return 'data:text/calendar;charset=utf-8,' + encodeURIComponent(lines.join('\n'));
    }

    function googleCalendarLink(e) {
      const fmt = (d) => d.toISOString().replace(/[-:]|\.\d{3}/g,'');
      const dates = e.end ? `${fmt(e.start)}/${fmt(e.end)}` : `${fmt(e.start)}`;
      const params = new URLSearchParams({
        action: 'TEMPLATE',
        text: e.title || 'Event',
        dates,
        details: e.description || '',
        location: e.location || ''
      });
      return `https://www.google.com/calendar/render?${params.toString()}`;
    }

    function renderEvents(events) {
      const now = new Date();
      const expanded = expandRecurring(events, now);
      const upcoming = expanded.filter(e => e.end ? e.end >= now : e.start >= now)
                               .sort((a,b) => a.start - b.start);
      const nextContainer = document.getElementById('next-event');
      const nextCard = document.getElementById('next-event-card');
      const list = document.getElementById('events-list');
      const empty = document.getElementById('events-empty');
      if (!list) return;
      list.innerHTML = '';
      if (upcoming.length === 0) {
        if (empty) empty.classList.remove('hidden');
        return;
      }
      if (empty) empty.classList.add('hidden');

      const [nextEvent, ...rest] = upcoming;
      if (nextContainer && nextCard && nextEvent) {
        nextContainer.classList.remove('hidden');
        nextCard.innerHTML = `
          <div class="flex items-start gap-4">
            <div class="flex-shrink-0 text-emerald-300 font-semibold">${new Intl.DateTimeFormat(undefined, {month:'short'}).format(nextEvent.start)}<div class="text-2xl leading-none">${nextEvent.start.getDate()}</div></div>
            <div class="space-y-1">
              <div class="text-lg font-semibold">${nextEvent.title || 'Untitled Event'}</div>
              <div class="text-slate-300 text-sm">${formatDateRange(nextEvent.start, nextEvent.end)}</div>
              ${nextEvent.location ? `<div class="text-slate-400 text-sm">${nextEvent.location}</div>` : ''}
              <div class="pt-3 flex flex-wrap gap-3 items-center">
                ${nextEvent.url ? `<a href="${nextEvent.url}" target="_blank" rel="noopener noreferrer" class="text-emerald-400 hover:text-emerald-300 text-sm">Details</a>` : ''}
                <a href="${buildIcsForEvent(nextEvent)}" download="event.ics" class="px-3 py-1.5 rounded border border-slate-700 hover:border-slate-600 text-xs">Add to Calendar (ICS)</a>
                <a href="${googleCalendarLink(nextEvent)}" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 rounded bg-emerald-500 text-slate-900 font-medium hover:bg-emerald-400 text-xs">Add to Google</a>
                <span class="ml-2 text-[10px] uppercase tracking-wide ${classifyEvent(nextEvent)==='regular' ? 'text-sky-300' : 'text-fuchsia-300'}">${classifyEvent(nextEvent)}</span>
              </div>
            </div>
          </div>`;
      }

      for (const e of rest.slice(0, 10)) {
        const item = document.createElement('div');
        item.className = 'p-4 rounded-lg border border-slate-800 bg-slate-900/40';
        item.innerHTML = `
          <div class="flex items-start gap-4">
            <div class="flex-shrink-0 text-emerald-300 font-medium">${new Intl.DateTimeFormat(undefined, {month:'short'}).format(e.start)}<div class="text-xl leading-none">${e.start.getDate()}</div></div>
            <div class="space-y-1">
              <div class="font-semibold">${e.title || 'Untitled Event'}</div>
              <div class="text-slate-300 text-sm">${formatDateRange(e.start, e.end)}</div>
              ${e.location ? `<div class="text-slate-400 text-sm">${e.location}</div>` : ''}
              <div class="pt-2 flex flex-wrap gap-3 items-center">
                ${e.url ? `<a href="${e.url}" target="_blank" rel="noopener noreferrer" class="text-emerald-400 hover:text-emerald-300 text-sm">Details</a>` : ''}
                <a href="${buildIcsForEvent(e)}" download="event.ics" class="px-3 py-1 rounded border border-slate-700 hover:border-slate-600 text-xs">ICS</a>
                <a href="${googleCalendarLink(e)}" target="_blank" rel="noopener noreferrer" class="px-3 py-1 rounded bg-emerald-500 text-slate-900 font-medium hover:bg-emerald-400 text-xs">Google</a>
                <span class="ml-2 text-[10px] uppercase tracking-wide ${classifyEvent(e)==='regular' ? 'text-sky-300' : 'text-fuchsia-300'}">${classifyEvent(e)}</span>
              </div>
            </div>
          </div>`;
        list.appendChild(item);
      }
    }

    function expandRecurring(events, now) {
      // Minimal weekly RRULE expansion for the next ~90 days
      const horizonMs = 90 * 24 * 60 * 60 * 1000;
      const horizon = new Date(now.getTime() + horizonMs);
      const out = [];
      for (const e of events) {
        if (e.rrule && /FREQ=WEEKLY/i.test(e.rrule)) {
          const intervalMatch = e.rrule.match(/INTERVAL=(\d+)/i);
          const interval = intervalMatch ? parseInt(intervalMatch[1], 10) : 1;
          const bydayMatch = e.rrule.match(/BYDAY=([A-Z,]+)/i);
          const days = bydayMatch ? bydayMatch[1].split(',') : [];
          const baseDow = e.start.getUTCDay();
          const map = {SU:0, MO:1, TU:2, WE:3, TH:4, FR:5, SA:6};
          const start = new Date(e.start);
          let cursor = new Date(start);
          // generate weeks
          while (cursor <= horizon) {
            const occurrences = days.length ? days.map(code => map[code]).filter(d=>d!=null) : [baseDow];
            for (const dow of occurrences) {
              const occ = new Date(Date.UTC(cursor.getUTCFullYear(), cursor.getUTCMonth(), cursor.getUTCDate()));
              const delta = (dow - occ.getUTCDay() + 7) % 7;
              occ.setUTCDate(occ.getUTCDate() + delta);
              const occStart = new Date(occ);
              occStart.setUTCHours(e.start.getUTCHours(), e.start.getUTCMinutes(), e.start.getUTCSeconds(), 0);
              const duration = e.end ? (e.end - e.start) : 60*60*1000;
              const occEnd = new Date(occStart.getTime() + duration);
              if (occEnd >= now && occStart <= horizon) {
                out.push({...e, start: new Date(occStart), end: new Date(occEnd)});
              }
            }
            cursor.setUTCDate(cursor.getUTCDate() + 7 * interval);
          }
        } else {
          out.push(e);
        }
      }
      return out;
    }

    async function fetchAndRenderEvents(icsUrl) {
      try {
        let text = '';
        let res = await fetch(icsUrl, { cache: 'no-store' });
        if (!res.ok) {
          throw new Error('Primary fetch failed');
        }
        text = await res.text();
        const events = parseIcs(text);
        renderEvents(events);
      } catch (err) {
        console.warn('ICS fetch failed, trying CORS proxy', err);
        try {
          const proxied = 'https://r.jina.ai/http://'+ icsUrl.replace(/^https?:\/\//,'');
          const res2 = await fetch(proxied, { cache: 'no-store' });
          if (!res2.ok) throw new Error('Proxy fetch failed');
          const text2 = await res2.text();
          const events2 = parseIcs(text2);
          renderEvents(events2);
        } catch (err2) {
          console.warn('ICS proxy fetch/parse failed', err2);
        }
      }
    }

    async function fetchAndRenderFullCalendar(icsUrl) {
      try {
        let text = '';
        let res = await fetch(icsUrl, { cache: 'no-store' });
        if (!res.ok) throw new Error('Primary fetch failed');
        text = await res.text();
        renderFullCalendarFromIcs(text);
      } catch (err) {
        try {
          const proxied = 'https://r.jina.ai/http://' + icsUrl.replace(/^https?:\/\//, '');
          const res2 = await fetch(proxied, { cache: 'no-store' });
          if (!res2.ok) throw new Error('Proxy fetch failed');
          const text2 = await res2.text();
          renderFullCalendarFromIcs(text2);
        } catch (e) {
          console.warn('FullCalendar ICS load failed', e);
        }
      }
    }

    function renderFullCalendarFromIcs(icsText) {
      const events = parseIcs(icsText);
      const expanded = expandRecurring(events, new Date());
      const fcEvents = expanded.map(e => ({
        title: e.title || 'Event',
        start: e.start,
        end: e.end,
        url: e.url || undefined
      }));
      const el = document.getElementById('fullcalendar');
      if (!el || !window.FullCalendar) return;
      if (fcInstance) { fcInstance.destroy(); fcInstance = null; }
      fcInstance = new FullCalendar.Calendar(el, {
        initialView: 'dayGridMonth',
        height: 'auto',
        themeSystem: 'standard',
        eventClick: (info) => {
          if (info.event.url) { info.jsEvent.preventDefault(); window.open(info.event.url, '_blank', 'noopener'); }
        },
        events: fcEvents
      });
      fcInstance.render();
    }

    function updateFooterQr(page) {
      const toggle = document.getElementById('footer-qr-toggle');
      const panel = document.getElementById('footer-qr-panel');
      const canvas = document.getElementById('footer-qr-canvas');
      const dl = document.getElementById('footer-qr-download');
      const copyBtn = document.getElementById('footer-qr-copy');
      if (!toggle || !panel || !canvas) return;
      const url = window.location.href; // exact URL, includes ?page=...
      const ECL_LEVELS = ['L','M','Q','H'];
      let eclIndex = 1; // default 'M'
      const infoEl = document.getElementById('footer-qr-info');
      const render = (text) => {
        if (window.QRCode) {
          try {
            // compute model to surface version/module count
            let versionDesc = '';
            try {
              const model = QRCode.create(text, { errorCorrectionLevel: ECL_LEVELS[eclIndex] });
              versionDesc = `QR Version ${model.version} (${model.modules.size}√ó${model.modules.size})`;
            } catch {}
            QRCode.toCanvas(canvas, text, { width: 160, margin: 1, errorCorrectionLevel: ECL_LEVELS[eclIndex] }, function(err){
              if (err) fallbackImg(text);
              if (infoEl) infoEl.textContent = versionDesc || '';
              const lenEl = document.getElementById('footer-qr-length');
              if (lenEl) lenEl.textContent = `Length: ${text.length}`;
            });
          } catch { fallbackImg(text); }
        } else {
          fallbackImg(text);
        }
      };
      function fallbackImg(text){
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0,0,canvas.width,canvas.height);
        if (infoEl) infoEl.textContent = `Encoder error`;
        const lenEl = document.getElementById('footer-qr-length');
        if (lenEl) lenEl.textContent = `length ${text.length}`;
      }
      render(url);
      // Input-driven generation
      const input = document.getElementById('footer-qr-input');
      const eclText = document.getElementById('footer-qr-ecl');
      const eclInc = document.getElementById('footer-qr-ecl-inc');
      const eclDec = document.getElementById('footer-qr-ecl-dec');
      if (input) {
        input.value = url;
        input.addEventListener('input', () => render(input.value || url));
        // Show the end of long text by moving caret to the end and scrolling right
        setTimeout(() => {
          try {
            const len = input.value.length;
            input.setSelectionRange(len, len);
            input.scrollLeft = input.scrollWidth;
          } catch {}
        }, 0);
        input.addEventListener('focus', () => {
          try {
            const len = input.value.length;
            input.setSelectionRange(len, len);
            input.scrollLeft = input.scrollWidth;
          } catch {}
        });
      }
      if (eclText) eclText.textContent = ECL_LEVELS[eclIndex];
      function reRender(){ render((input && input.value) || url); }
      if (eclInc) {
        eclInc.onclick = () => { if (eclIndex < ECL_LEVELS.length - 1) { eclIndex++; if (eclText) eclText.textContent = ECL_LEVELS[eclIndex]; reRender(); } };
      }
      if (eclDec) {
        eclDec.onclick = () => { if (eclIndex > 0) { eclIndex--; if (eclText) eclText.textContent = ECL_LEVELS[eclIndex]; reRender(); } };
      }
      if (dl) {
        dl.onclick = () => {
          const tmpCanvas = document.createElement('canvas');
          const text = (input && input.value) || url;
          try {
            QRCode.toCanvas(tmpCanvas, text, { width: 512, margin: 1, errorCorrectionLevel: ECL_LEVELS[eclIndex] }, () => {
              const link = document.createElement('a');
              link.download = `qr-${page}.png`;
              link.href = tmpCanvas.toDataURL('image/png');
              link.click();
            });
          } catch {
            // Fallback: copy current on-screen canvas into a PNG
            const ctx = tmpCanvas.getContext('2d');
            tmpCanvas.width = canvas.width; tmpCanvas.height = canvas.height;
            ctx.drawImage(canvas, 0, 0);
            const link = document.createElement('a');
            link.download = `qr-${page}.png`;
            link.href = tmpCanvas.toDataURL('image/png');
            link.click();
          }
        };
      }
      toggle.onclick = () => {
        panel.classList.toggle('hidden');
      };
    }

    function renderResourcesPage(preselectedFilter) {
      const data = [
        { name: 'quipqiup', url: 'https://www.quipqiup.com/', cat: 'code-breaking' },
        { name: 'Boxentriq', url: 'https://www.boxentriq.com/', cat: 'code-breaking' },
        { name: 'CyberChef', url: 'https://cyberchef.io/', cat: 'ctf-tools' },
        { name: 'CCRI Cybersecurity & Safety site', url: 'https://www.ccri.edu/its/cybersecurity/', cat: 'ccri' },
        { name: 'Fortinet Training Institute', url: 'https://training.fortinet.com/', cat: 'ccri' },
        { name: 'Security Certification Roadmap (Paul Jerimy)', url: 'https://pauljerimy.com/security-certification-roadmap/', cat: 'ccri' },
        { name: 'CCRI Cybersecurity Resources', url: 'https://www.ccri.edu/comp/cybersecurity/websites.html', cat: 'ccri' },
        { name: 'CCRI Standardized Credit Awards', url: 'https://www.ccri.edu/priorlearning/creditawards.html', cat: 'ccri' },
        { name: 'CompTIA: Explore Tech Careers', url: 'https://www.comptia.org/en-us/explore-careers/job-roles/?page=1&category=all', cat: 'ccri' },
        { name: 'Cyberknights GitHub', url: 'https://github.com/CCRI-Cyberknights/', cat: 'cyberknights' },
        { name: 'Cybersecurity Club Discord', url: 'https://discord.com/channels/1159622463647387719/1159622463647387722', cat: 'cyberknights' },
        { name: 'NCL Competition', url: 'https://nationalcyberleague.org/competition', cat: 'ctf-competitions' },
        { name: 'NCAE CyberGames', url: 'https://ncaecybergames.org/#', cat: 'ctf-competitions' },
        { name: 'CCRI Cybersecurity Student Club', url: 'https://www.ccri.edu/comp/cybersecurity/studentclub.html', cat: 'cyberknights' },
        { name: 'STEM Day 2025 Cyber Game', url: 'https://github.com/CCRI-Cyberknights/stemday_takehome.git', cat: 'stem' }
      ];

      const grid = document.getElementById('resources-grid');
      const table = document.getElementById('resources-table');
      const search = document.getElementById('resources-search');
      const filterButtons = Array.from(document.querySelectorAll('[data-filter]'));
      const catNames = { 'code-breaking': 'Code Breaking Tools', 'ctf-tools': 'CTF Tools', 'ctf-competitions': 'CTF Competitions', 'ccri': 'CCRI & Certs', 'cyberknights': 'Cyberknights', 'stem': 'STEM Day' };
      const availableFilters = new Set(filterButtons.map(b => b.dataset.filter));
      const initialFilter = (preselectedFilter && availableFilters.has(preselectedFilter)) ? preselectedFilter : 'all';

      function setActive(filter) {
        filterButtons.forEach(b => b.classList.remove('ring-1','ring-emerald-500'));
        const target = filterButtons.find(b => b.dataset.filter === filter) || filterButtons.find(b => b.dataset.filter === 'all');
        if (target) target.classList.add('ring-1','ring-emerald-500');
      }

      function renderLists(items) {
        if (grid) {
          grid.innerHTML = '';
          for (const r of items) {
            const catLabel = catNames[r.cat] || r.cat;
            const card = document.createElement('a');
            card.href = r.url; card.target = '_blank'; card.rel = 'noopener noreferrer';
            card.className = 'block p-3 rounded border border-slate-800 bg-slate-900/60 hover:border-emerald-600';
            card.innerHTML = `<div class="text-sm font-medium text-slate-100">${r.name}</div><div class="text-[11px] text-slate-400">${catLabel}</div>`;
            grid.appendChild(card);
          }
        }
        if (table) {
          table.innerHTML = '';
          for (const r of items) {
            const catLabel = catNames[r.cat] || r.cat;
            const tr = document.createElement('tr');
            tr.innerHTML = `<td class="py-1 pr-3">${r.name}</td><td class="py-1 pr-3">${catLabel}</td><td class="py-1 pr-3 break-all"><a href="${r.url}" target="_blank" rel="noopener noreferrer" class="text-emerald-400 hover:text-emerald-300">${r.url}</a></td>`;
            table.appendChild(tr);
          }
        }
      }

      function applyFilters() {
        const q = (search && search.value || '').toLowerCase();
        const active = filterButtons.find(b => b.classList.contains('ring-1'))?.dataset.filter || 'all';
        let items = data.slice();
        if (active !== 'all') items = items.filter(r => r.cat === active);
        if (q) items = items.filter(r => {
          const catLabel = (catNames[r.cat] || r.cat).toLowerCase();
          return r.name.toLowerCase().includes(q) || r.url.toLowerCase().includes(q) || catLabel.includes(q);
        });
        renderLists(items);
      }

      filterButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const filter = btn.dataset.filter || 'all';
          if (filter === 'all') {
            location.hash = '#/resources';
          } else {
            location.hash = '#/resources/' + filter;
          }
        });
      });
      if (search) search.addEventListener('input', applyFilters);
      setActive(initialFilter);
      applyFilters();
    }

    window.addEventListener('hashchange', render);
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('year').textContent = new Date().getFullYear();
      normalizeHashRouting();
      // Mobile navigation removed - using direct navigation
      render();
    });
  </script>
</body>
</html>


