<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title id="page-title">Cyber Club</title>
  <meta name="description" content="A centralized hub for the CCRI Cyber Club. Find information about when and where to find the Cyberknights, and much more!">
    <meta name="version" content="" id="version-meta">
  <meta property="og:title" content="CCRI Cyber Club">
  <meta property="og:description" content="A centralized hub for the CCRI Cyber Club. Find information about when and where to find the Cyberknights, and much more!">
  <meta property="og:image" content="https://ccri-cyberknights.github.io/page/images/branding/cybersmith.webp">
  <link rel="icon" href="favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="./js/qrcode.min.js"></script>
  <script src="./js/qr-code-manager.js"></script>
  <script src="./js/version-display.js"></script>
  <style>
    :root { color-scheme: dark; }
    
    /* Expandable Element System - Clean and DRY */
    .expand-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      -webkit-tap-highlight-color: transparent;
    }

    .expand-dialog {
      position: relative;
      max-width: var(--expand-max-width, 90vw);
      max-height: var(--expand-max-height, 90vh);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      border-radius: 8px;
      background: transparent;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .expand-content {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      box-sizing: border-box;
    }

    .expand-content img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
      border-radius: 8px;
      box-shadow: 0 0 60px rgba(16,185,129,0.5);
    }

    .expand-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      border-radius: 6px;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: background 0.2s ease;
    }

    .expand-close:hover {
      background: rgba(0,0,0,0.9);
    }

    .expand-qr-meta {
      position: absolute;
      bottom: 12px;
      left: 12px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 13px;
    }
    
    /* Modal Animation States */
    .modal-enter {
      opacity: 0;
    }
    
    .modal-enter-active {
      opacity: 1;
      transition: opacity 0.3s ease-out;
    }
    
    .modal-exit {
      opacity: 1;
    }
    
    .modal-exit-active {
      opacity: 0;
      transition: opacity 0.3s ease-in;
    }
    
    /* Focus trap styles */
    .modal-focus-trap {
      outline: none;
    }
    
    /* Scrollbar styling for modal content */
    .modal-body::-webkit-scrollbar {
      width: 6px;
    }
    
    .modal-body::-webkit-scrollbar-track {
      background: #1e293b;
      border-radius: 3px;
    }
    
    .modal-body::-webkit-scrollbar-thumb {
      background: #475569;
      border-radius: 3px;
    }
    
    .modal-body::-webkit-scrollbar-thumb:hover {
      background: #64748b;
    }
    
    
    /* Dynamic intro text with smooth CSS transitions */
    #intro-text {
      position: relative;
      color: #fff;
      text-shadow: 0 0 5px rgba(255, 165, 0, 0.5);
      transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      transform: scale(1);
    }

    #intro-text:hover {
      text-shadow: 0 0 15px rgba(255, 165, 0, 0.8);
      transform: scale(1.02);
    }

    /* Smooth text change animation */
    .text-change {
      animation: textChange 0.8s ease-out;
    }

    @keyframes textChange {
      0% { opacity: 0.7; transform: scale(0.98); }
      50% { opacity: 1; transform: scale(1.02); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    /* Spark glow animation for Sign Up button */
    .btn-sparkle {
      position: relative;
      background-image: linear-gradient(90deg, rgba(34,197,94,0.10), rgba(245,158,11,0.10));
      box-shadow: 0 0 0 rgba(34,197,94,0);
      animation: sparkPulse 2.4s ease-in-out infinite;
      transition: transform 150ms ease, box-shadow 150ms ease;
    }
    .btn-sparkle:hover { transform: translateY(-1px); }
    @keyframes sparkPulse {
      0%, 100% {
        box-shadow: 0 0 8px 0 rgba(34,197,94,0.25), 0 0 0 0 rgba(245,158,11,0.0);
        border-color: #22c55e;
      }
      50% {
        box-shadow: 0 0 14px 6px rgba(245,158,11,0.35), 0 0 28px 10px rgba(34,197,94,0.30);
        border-color: #f59e0b;
      }
    }
    @media (prefers-reduced-motion: reduce) {
      .btn-sparkle { animation: none; }
    }
    
    /* Input field flash animation to indicate mutability */
    .input-flash {
      animation: inputFlash 1.5s ease-in-out;
    }
    @keyframes inputFlash {
      0% {
        border-color: #475569;
        box-shadow: 0 0 0 0 rgba(245, 158, 11, 0);
      }
      20% {
        border-color: #f59e0b;
        box-shadow: 0 0 8px 0 rgba(245, 158, 11, 0.4);
      }
      40% {
        border-color: #f59e0b;
        box-shadow: 0 0 12px 4px rgba(245, 158, 11, 0.3);
      }
      100% {
        border-color: #475569;
        box-shadow: 0 0 0 0 rgba(245, 158, 11, 0);
      }
    }
    @media (prefers-reduced-motion: reduce) {
      .input-flash { animation: none; }
    }
    
    /* Mobile search UX improvements */
    @media (max-width: 768px) {
      #search-results-container {
        position: fixed !important;
        top: auto !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        max-height: 50vh !important;
        border-radius: 0 !important;
        border-left: none !important;
        border-right: none !important;
        border-bottom: none !important;
      }
      
      /* Ensure search input doesn't get covered by virtual keyboard */
      #resources-search {
        font-size: 16px; /* Prevents zoom on iOS */
      }
    }
    
    /* CYBERKNIGHT FORGE COLOR PALETTE - HYBRID */
    :root {
      --forge-black: #001011;      /* deep forge darkness */
      --iron-ash: #1C1C1C;        /* dark charcoal base */
      --dark-steel: #3A3A3A;      /* darker metallic tone */
      --steel-glow: #5B6E6E;      /* metallic sheen */
      --silver-edge: #8A8A8A;     /* mid-tone metal */
      --pale-alloy: #B8B8B8;      /* light metallic */
      --primary-green: #04703C;   /* corrected primary green - deep forest */
      --primary-green-light: #0A8B4F; /* lighter variant for hover */
      --neon-surge: #43CC50;      /* visor glow; ancillary accent */
      --ember-spark: #C27329;     /* flying sparks; warm accent - CANONICAL ORANGE */
      --ember-spark-light: #D4843A; /* lighter orange for hover states */
      --arc-weld-blue: #2DB2C4;   /* electric arc welding */
      --molten-glow: #FFCC33;     /* bright molten metal */
    }

    /* Image Toggle System - CSS Custom Properties for Consistency */
    :root {
      --image-expanded-width: min(96vw, 1400px);
      --image-expanded-height: min(96vh, 1000px);
      --image-expanded-bg: rgba(0, 0, 0, 0.9);
      --image-expanded-padding: 2rem;
      --image-expanded-shadow: 0 0 60px rgba(16, 185, 129, 0.5);
      --image-expanded-radius: 1rem;
    }

    /* Neon Surge Links - Official Color Palette */
    .neon-surge-link {
      color: var(--neon-surge);
    }
    
    .neon-surge-link:hover {
      opacity: 0.8;
    }

    /* All image toggle states now handled by modal overlay pattern */
    
    /* Mobile footer fix - ensure footer is never clipped by mobile browser UI */
    @media (max-width: 768px) {
      footer {
        padding-bottom: 20px !important;
        margin-bottom: 10px !important;
      }
    }

    /* Navigation active state styling - visible emerald accent */
    nav a[data-route].active {
      background-color: rgba(16, 185, 129, 0.3) !important;
      border-color: rgb(16, 185, 129) !important;
      color: rgb(209, 250, 229) !important;
    }
    
    nav a[data-route].active:hover {
      background-color: rgba(16, 185, 129, 0.4) !important;
      border-color: rgb(52, 211, 153) !important;
      color: rgb(255, 255, 255) !important;
    }

  </style>
</head>
<body class="min-h-screen bg-[var(--forge-black)] text-[var(--pale-alloy)]">

  <header class="max-w-5xl mx-auto px-4 py-6">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img id="cyberknight-icon" src="images/branding/cybersmith.webp" alt="Cyberknights" class="w-10 h-10 rounded hover:scale-110 cursor-pointer transition-transform duration-200 ease-in-out" onclick="expandElement(this)" tabindex="0" title="Click to expand" />
      </div>
      <nav class="flex gap-2 text-sm">
        <a href="#/home" class="px-3 py-2 rounded-md bg-slate-800/50 hover:bg-slate-700/70 border border-slate-700 hover:border-slate-600 transition-all duration-200 text-slate-200 hover:text-white font-medium" data-route="home">Home</a>
        <a href="#/linux" class="px-3 py-2 rounded-md bg-slate-800/50 hover:bg-slate-700/70 border border-slate-700 hover:border-slate-600 transition-all duration-200 text-slate-200 hover:text-white font-medium" data-route="linux">Linux</a>
        <a href="#/calendar" class="px-3 py-2 rounded-md bg-slate-800/50 hover:bg-slate-700/70 border border-slate-700 hover:border-slate-600 transition-all duration-200 text-slate-200 hover:text-white font-medium" data-route="calendar">Calendar</a>
        <a href="#/resources" class="px-3 py-2 rounded-md bg-slate-800/50 hover:bg-slate-700/70 border border-slate-700 hover:border-slate-600 transition-all duration-200 text-slate-200 hover:text-white font-medium" data-route="resources">Resources</a>
      </nav>
    </div>
  </header>

  <main id="app" class="max-w-5xl mx-auto px-4 pb-8"></main>


  <footer class="border-t border-slate-800/60 mt-6 pb-safe">
    <div class="max-w-5xl mx-auto px-4 py-1 text-xs text-slate-400 flex items-center justify-between">
      <div class="flex flex-col items-center gap-0 hover:text-slate-300 transition-colors relative group">
        <div>
          ¬© <span id="year"></span> Zachary Hartmann
        </div>
        <div class="text-slate-500 text-[10px]">
          (President, CCRI Cyber Club)
        </div>
        <div class="text-slate-500 text-[10px]">
          <span id="version"></span>
        </div>
        <!-- Tooltip -->
        <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-slate-800 text-slate-300 text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-20">
          <span id="version-tooltip"></span>
        </div>
      </div>
      <div class="relative">
        <button id="footer-qr-toggle" class="hover:opacity-80 transition-all duration-200 focus:ring-2 focus:ring-slate-500 focus:outline-none inline-flex items-center justify-center" style="color: var(--pale-alloy); height: 64px; width: 64px;">
          <div id="footer-qr-svg" class="rounded border border-white/20" style="width: 64px; height: 64px;"></div>
        </button>
        <div id="footer-qr-panel" class="hidden absolute bottom-full right-0 mb-1 p-4 rounded-lg border border-slate-600 bg-slate-800 shadow-lg w-[300px] sm:w-[300px] max-w-[90vw] z-10">
          <div class="space-y-3">
            <div class="flex justify-center">
              <div class="p-4 rounded border border-slate-700 bg-slate-700/60 inline-block">
                <canvas id="footer-qr-canvas" class="bg-white p-1 rounded transition-opacity duration-200 ease-in-out hover:opacity-80" width="160" height="160" tabindex="0" title="QR code canvas (fallback)"></canvas>
              </div>
            </div>
            <div class="space-y-2">
              <div>
                <input id="footer-qr-input" type="text" placeholder="Enter text or URL" class="w-full px-2 py-1 rounded bg-slate-700 border border-slate-600 outline-none focus:border-emerald-500 text-slate-200 input-flash" />
              </div>
              <div class="flex gap-2">
                <div class="rounded border border-slate-700 bg-slate-700/60 p-2 flex-1 flex flex-col justify-center gap-2">
                  <div class="flex text-[11px] text-slate-400">
                    <span class="flex-1 text-center">Length:</span><span id="footer-qr-length" class="flex-1 text-slate-400 font-bold">0</span>
                  </div>
                  <div class="flex text-[11px] text-slate-400">
                    <span class="flex-1 text-center">QR ver:</span><span id="footer-qr-info" class="flex-1 text-slate-400 font-bold"></span>
                  </div>
                </div>
                <div class="rounded border border-slate-700 bg-slate-700/60 p-2 flex-1">
                  <div class="text-[11px] text-slate-400 text-center mb-1">Error Correction Level</div>
                  <div class="flex justify-center items-center gap-1">
                    <button id="footer-qr-ecl-dec" class="px-2 py-1 rounded-full border border-slate-700 text-sm font-bold text-slate-200 transition-all duration-200 hover:bg-slate-700 hover:border-slate-600 hover:scale-110 hover:shadow-md focus:ring-2 focus:ring-slate-500 focus:outline-none active:scale-95 active:bg-slate-600" title="Lower error correction">‚àí</button>
                    <span id="footer-qr-ecl" class="min-w-[1.5ch] text-slate-200 text-xs text-center">M</span>
                    <button id="footer-qr-ecl-inc" class="px-2 py-1 rounded-full border border-slate-700 text-sm font-bold text-slate-200 transition-all duration-200 hover:bg-slate-700 hover:border-slate-600 hover:scale-110 hover:shadow-md focus:ring-2 focus:ring-slate-500 focus:outline-none active:scale-95 active:bg-slate-600" title="Raise error correction">+</button>
                  </div>
                </div>
              </div>
              <div class="flex justify-center">
                <button id="footer-qr-download" class="px-3 py-1 rounded border border-slate-700 text-slate-200 transition-all duration-200 hover:bg-slate-700 hover:border-slate-600 hover:scale-105 hover:shadow-md focus:ring-2 focus:ring-slate-500 focus:outline-none active:scale-95 active:bg-slate-600">Download PNG</button>
              </div>
            </div>
          </div>
        </div>
        </div>
      </div>
    </div>
    </footer>
  </div>

  <template id="page-home">
    <!-- Excitement Opportunity Belonging Banner -->
    <div class="w-full text-white text-sm tracking-wide mb-6" style="background-color: var(--primary-green);">
      <div class="max-w-5xl mx-auto px-4 py-3 flex flex-wrap items-center justify-center gap-4 text-center">
        <span class="font-semibold">Excitement</span>
        <span>‚Ä¢</span>
        <span class="font-semibold">Opportunity</span>
        <span>‚Ä¢</span>
        <span class="font-semibold">Belonging</span>
      </div>
    </div>
    
    <!-- Hero Section -->
    <section class="mb-12 p-6 rounded-lg border" style="border-color: var(--primary-green); background: linear-gradient(to right, rgba(4, 112, 60, 0.1), rgba(67, 204, 80, 0.1));">
      <div class="text-center space-y-4">
        <h1 class="text-2xl sm:text-3xl font-bold" style="color: var(--primary-green);">
          We've Moved to a Bigger Venue!
        </h1>
        <p class="text-slate-300 max-w-2xl mx-auto">
          Thanks to overwhelming interest, we've outgrown our old room. Join us in our new home, the Auditorium (Room 4080).
        </p>
        <div class="pt-2">
          <a href="#/map-warwick-4080" class="inline-flex items-center px-6 py-3 rounded-lg font-semibold transition-colors" style="background-color: var(--ember-spark); color: var(--forge-black);" onmouseover="this.style.backgroundColor='var(--molten-glow)'" onmouseout="this.style.backgroundColor='var(--ember-spark)'">
            Find Our New Location
            <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
          </a>
        </div>
      </div>
    </section>

    <!-- Main Club Introduction -->
    <section class="grid lg:grid-cols-2 items-center gap-10 pt-4">
      <div class="space-y-6">
        <h2 class="text-3xl sm:text-4xl font-bold leading-tight">
          Who are the Cyber Knights?
        </h2>
        
        
        <p class="text-slate-300">
          We're a student community learning cybersecurity through hands-on workshops, labs, and projects. 
          Join us for game nights, competitions, and practical learning experiences.
        </p>
        <div class="flex flex-wrap gap-3">
          <a href="#/resources" class="px-4 py-2 rounded border border-slate-700 hover:border-slate-600">Explore Resources</a>
        </div>
      </div>
      <div class="flex justify-center">
        <img id="cyberknight-welder-large" src="images/branding/cyberknight-welder.webp" alt="Cyberknights" class="w-72 h-72 object-contain drop-shadow-[0_0_40px_rgba(16,185,129,0.25)] cursor-pointer transition-transform duration-200 ease-in-out hover:scale-105" onclick="expandElement(this)" tabindex="0" title="Click to expand" />
      </div>
    </section>

    <!-- Mission Statement -->
    <section class="mt-12">
      <div class="flex flex-col lg:flex-row gap-6">
        <!-- Mission Box -->
        <div class="flex-1 p-6 rounded-lg border border-slate-800 bg-slate-900/40">
          <h3 class="text-lg font-semibold mb-3">Our Mission</h3>
          <p class="text-slate-300 mb-4">
            Building a thriving cybersecurity community at CCRI through:
          </p>
          <ul class="text-slate-300 space-y-2 text-sm">
            <li class="flex items-start">
              <span class="font-semibold text-white mr-2">‚Ä¢</span>
              <span>Game nights and social events for all skill levels</span>
            </li>
            <li class="flex items-start">
              <span class="font-semibold text-white mr-2">‚Ä¢</span>
              <span>Practical workshops beyond traditional lectures</span>
            </li>
            <li class="flex items-start">
              <span class="font-semibold text-white mr-2">‚Ä¢</span>
              <span>Welcoming environment for all skill levels</span>
            </li>
          </ul>
        </div>
        
        <!-- Key Selling Points Box -->
        <div class="flex-1 p-6 rounded-lg border-2 border-emerald-500/60 bg-gradient-to-r from-emerald-900/20 to-emerald-800/20 text-center shadow-lg" style="background: linear-gradient(135deg, rgba(4, 112, 60, 0.15), rgba(16, 185, 129, 0.1));">
          <div class="text-xl font-bold mb-4" style="color: var(--neon-surge);">Our Members Get Hired!</div>
          <div class="text-base mb-3 text-slate-300">From resumes to real jobs ‚Äî we help you land the role.</div>
          <div class="text-base mb-3 text-slate-300">Build skills. Make connections. Get hired.</div>
          <div class="text-base mb-3 text-slate-300">Workshops, networking, competitions ‚Äî straight to careers.</div>
          <div class="text-base mb-4 text-slate-300">Real experience. Real employers. Real results.</div>
        </div>
      </div>
    </section>

    <!-- What We Do & Get Involved -->
    <section class="mt-12 grid sm:grid-cols-2 gap-6">
      <div class="p-5 rounded-lg border border-slate-800 bg-slate-900/40">
        <h3 class="font-semibold mb-2">What we do</h3>
        <p class="text-slate-300 text-sm">Our club competes against other schools as a team in cybersecurity competitions. Members build skills through Capture the Flag (CTF) competitions, land jobs via networking, and form lasting connections.</p>
        <div class="mt-3 flex flex-wrap gap-2 text-xs">
          <a href="#/resources/ctf-tools" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CTF & Code Breaking</a>
          <a href="#/resources/ctf-competitions" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CTF Competitions</a>
          <a href="#/resources/ccri" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CCRI & Certs</a>
          <a href="#/resources/cyberknights" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Community</a>
        </div>
      </div>
      <div class="p-5 rounded-lg border border-slate-800 bg-slate-900/40">
        <h3 class="font-semibold mb-2">Get involved</h3>
        <p class="text-slate-300 text-sm mb-3">Join our meetings, Discord, and events throughout the semester.</p>
        
        <div class="mt-3 flex flex-wrap gap-2 text-xs">
          <a href="#/calendar" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Club Calendar</a>
          <a href="#/resources/ctf-competitions" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Competitions</a>
          <a href="#/resources/cyberknights" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Cyberknights</a>
          <a href="#/resources/stem" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">STEM Day</a>
          <a href="#/blog" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Updates & Blog</a>
        </div>
        <div class="mt-4 flex flex-wrap gap-3">
          <a href="https://www.ccri.edu/comp/cybersecurity/studentclub-1.html" target="_blank" rel="noopener noreferrer" class="px-4 py-2 rounded border border-[#22c55e] text-[#22c55e] hover:bg-[#22c55e]/10">
            CCRI Cybersecurity Student Club
            <svg class="inline w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
            </svg>
          </a>
          <a href="https://forms.cloud.microsoft/r/U26WUVJGgp" target="_blank" rel="noopener noreferrer" class="px-4 py-2 rounded border border-[#22c55e] text-[#22c55e] hover:bg-[#22c55e]/10 btn-sparkle">
            Sign Up
            <svg class="inline w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
            </svg>
          </a>
        </div>
      </div>
    </section>
  </template>

  <template id="page-blog">
    <section class="space-y-6">
      <div class="text-center mb-8">
        <h2 class="text-3xl sm:text-4xl font-bold mb-2">Updates & Blog</h2>
        <p class="text-slate-300 mt-4">Stay updated with club news, meeting recaps, and member achievements.</p>
      </div>

      <div class="grid gap-6">
        <!-- Coming Soon Card -->
        <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40">
          <h3 class="text-xl font-semibold mb-3 text-emerald-400">Coming Soon</h3>
          <p class="text-slate-300 mb-4">
            We're building a comprehensive blog to share club updates, meeting recaps, member spotlights, 
            competition results, and institutional memory. This will serve as our central hub for 
            chronological content and community engagement.
          </p>
          <div class="text-sm text-slate-400">
            <p class="mb-2">Planned features:</p>
            <ul class="list-disc list-inside space-y-1">
              <li>Meeting recaps and photos</li>
              <li>Member achievements and job placements</li>
              <li>Competition results and highlights</li>
              <li>Club announcements and updates</li>
              <li>Institutional memory preservation</li>
            </ul>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40">
          <h3 class="text-lg font-semibold mb-3">Stay Connected</h3>
          <div class="flex flex-wrap gap-3">
            <a href="#/calendar" class="px-4 py-2 rounded border border-emerald-600 text-emerald-400 hover:bg-emerald-600/10">View Calendar</a>
            <a href="#/resources/cyberknights" class="px-4 py-2 rounded border border-emerald-600 text-emerald-400 hover:bg-emerald-600/10">Join Discord</a>
            <a href="#/home" class="px-4 py-2 rounded border border-emerald-600 text-emerald-400 hover:bg-emerald-600/10">Back to Club Home</a>
          </div>
        </div>
      </div>
    </section>
  </template>

  <template id="page-linux">
    <section class="space-y-6">
      <div class="text-center mb-8">
        <p class="text-slate-300 mt-4">Learn how to install Linux distributions using USB drives or virtual machines.</p>
      </div>

      <!-- Navigation Index -->
      <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40 mb-8">
        <h3 class="text-lg font-semibold mb-4" style="color: var(--neon-surge);">Quick Navigation</h3>
        <div class="flex flex-wrap gap-4">
          <button onclick="scrollToSection('usb-boot-guide')" class="inline-flex items-center px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-medium transition-colors">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3"></path>
            </svg>
            USB Boot Guide
          </button>
          <button onclick="scrollToSection('virtualbox-boot-guide')" class="inline-flex items-center px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium transition-colors">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
            </svg>
            VirtualBox Boot Guide
          </button>
          <a href="#/resources/linux" class="inline-flex items-center px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white font-medium transition-colors">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
            </svg>
            Linux Learner's Guide
          </a>
        </div>
      </div>

      <!-- USB Boot Guide Section -->
      <div id="usb-boot-guide" class="space-y-6">
        <div class="text-center">
          <h3 class="text-2xl font-bold mb-2" style="color: var(--neon-surge);">USB Boot Guide</h3>
          <p class="text-slate-300">Boot directly from a USB drive to try any Linux distribution without installing.</p>
      </div>

      <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40">
          <h4 class="text-lg font-semibold mb-4" style="color: var(--neon-surge);">Step-by-Step Instructions</h4>
        <ol class="list-decimal list-inside space-y-3 text-slate-200">
          <li>Shut down your computer completely.</li>
          <li>Insert the prepared USB drive into an available USB port.</li>
          <li>Power on your computer and immediately start tapping the boot menu key (see below) as soon as the manufacturer logo appears.</li>
          <li>Continue tapping the key about twice per second until the boot menu opens.</li>
          <li>If you miss the timing, restart your computer and try again.</li>
          <li>Select the USB device from the boot menu and press Enter.</li>
          <li>Follow the on-screen instructions to try or install the Linux distribution.</li>
        </ol>
      </div>
      <p class="mt-2 text-slate-400 text-sm">Tip: Start tapping the key about twice per second right after pressing the power button. This is normal for most brands.</p>

        <div class="p-5 rounded-lg border border-slate-800 bg-slate-900/40">
          <h4 class="font-semibold mb-3">Common One-Time Boot Keys</h4>
        <div class="grid sm:grid-cols-2 gap-3 text-sm">
          <div><span class="text-slate-400">Dell</span>: F12</div>
          <div><span class="text-slate-400">HP</span>: Esc, F9</div>
          <div><span class="text-slate-400">Lenovo</span>: F12, Novo Button</div>
          <div><span class="text-slate-400">Acer</span>: F12</div>
            <div><span class="text-slate-400">ASUS</span>: Esc, F8, F12</div>
          <div><span class="text-slate-400">MSI</span>: F11</div>
          <div><span class="text-slate-400">Toshiba</span>: F12</div>
          <div><span class="text-slate-400">Samsung</span>: Esc, F12</div>
          </div>
        </div>
      </div>

      <!-- VirtualBox Boot Guide Section -->
      <div id="virtualbox-boot-guide" class="space-y-6 mt-12">
        <div class="text-center">
          <h3 class="text-2xl font-bold mb-2" style="color: var(--arc-weld-blue);">VirtualBox Boot Guide</h3>
          <p class="text-slate-300">Run any Linux distribution safely in a virtual machine using VirtualBox.</p>
        </div>

        <div class="p-5 rounded-lg border border-blue-800/30 bg-blue-900/20">
          <h4 class="font-semibold mb-3 text-blue-300">Prerequisites</h4>
          <ul class="list-disc list-inside space-y-2 text-slate-200 text-sm">
            <li>VirtualBox installed on your computer</li>
            <li>Linux ISO image file downloaded to your computer</li>
          </ul>
        </div>

        <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40">
          <h4 class="text-lg font-semibold mb-4" style="color: var(--arc-weld-blue);">Step-by-Step Instructions</h4>
          <ol class="list-decimal list-inside space-y-3 text-slate-200">
            <li>Download a Linux ISO image file to your computer.</li>
            <li>In VirtualBox, create a new machine by selecting <strong>Machine>New</strong> from file menu.</li>
            <li>Name the machine (e.g., "Linux VM") and select the <strong>.iso</strong> image file.</li>
            <li>A group of 4 buttons appears at bottom right of the window. You can toggle between Guided Mode and Expert Mode.
              <br>&nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ <strong>IMPORTANT:</strong> Ensure that you're in <strong>Guided Mode</strong>
              <br>&nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ ("Expert Mode" appears on the button when in Guided Mode)</li>
            <li>Check the box to <strong>"Skip unattended installation"</strong> and click <strong>"Next"</strong>.</li>
            <li>Assign <strong>4096 MB</strong> of memory and <strong>one CPU core</strong> to the virtual machine.*</li>
            <li>Set the virtual hard disk to <strong>50 gigabytes</strong> (an upper limit - does not actually take up the full amount).</li>
            <li>Click <strong>next</strong> and compare the summary to the one below before you click <strong>finish</strong>.</li>
          </ol>
          <p class="mt-3 text-sm" style="color: var(--steel-glow);">Note: You may adjust settings later to optimize performance on your hardware. (The initial choice of 1 core is intentional, as some CPUs exhibit instability when more cores are configured).</p>
        </div>
        
        <div class="mt-6 p-4 rounded-lg border border-slate-800 bg-slate-900/40">
          <h4 class="text-sm font-semibold mb-3 text-slate-300">Expected Summary Screen:</h4>
          <img id="vbox-summary-image" src="images/screenshots/VBoxSummary-optimized.webp" alt="VirtualBox Summary Screen showing expected configuration" class="w-full mx-auto rounded border border-slate-700 object-contain cursor-pointer transition-transform duration-200 ease-in-out hover:scale-105" onclick="expandElement(this)" tabindex="0" title="Click to expand" />
        </div>
      </div>

      <div class="mt-8">
        <a href="#/home" class="neon-surge-link transition-opacity">Back to Club Home</a>
        <span class="mx-2">‚Ä¢</span>
        <a href="#/resources/linux" class="neon-surge-link transition-opacity">Linux Learner's Guide</a>
      </div>
    </section>
  </template>

  <template id="page-calendar">
    <section class="space-y-6">
      <p class="text-slate-300">Upcoming meetings and events managed via the club Google Calendar.</p>

      <div id="calendar-callout" class="p-4 rounded border border-amber-500/40 bg-amber-900/20 text-amber-200 text-sm"></div>

      <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40">
        <h3 class="text-lg font-semibold mb-4">Meeting Types</h3>
        <p class="text-slate-300 mb-4">We offer a variety of meetings to appeal to a broad range of members.</p>
        <div class="space-y-4">
          <div class="flex items-start">
            <div class="flex-shrink-0 w-3 h-3 rounded-full mt-2 mr-3" style="background-color: #6B8E23;"></div>
            <div>
              <h4 class="font-semibold text-white">Warwick - 'A' meet (Mondays, 5-6pm)</h4>
              <p class="text-slate-300 text-sm">Official, formal meetings for interacting with faculty and discussing college initiatives. <a href="#/map-warwick-4080" class="neon-surge-link transition-opacity underline">Room 4080</a></p>
            </div>
          </div>
          <div class="flex items-start">
            <div class="flex-shrink-0 w-3 h-3 rounded-full mt-2 mr-3" style="background-color: #7C3AED;"></div>
            <div>
              <h4 class="font-semibold text-white">Warwick - 'B' meet (Wednesdays, 5-6pm)</h4>
              <p class="text-slate-300 text-sm">Informal, low-key sessions designed for small group interaction. <a href="#/map-warwick-4080" class="neon-surge-link transition-opacity underline">Room 4080</a></p>
            </div>
          </div>
          <div class="flex items-start">
            <div class="flex-shrink-0 w-3 h-3 rounded-full mt-2 mr-3" style="background-color: #F97316;"></div>
            <div>
              <h4 class="font-semibold text-white">Newport Campus Meeting (Saturdays, 10am-1pm)</h4>
              <p class="text-slate-300 text-sm">Specifically for preparing for cybersecurity competitions like <a href="https://ccri-cyberknights.github.io/page/#/resources/ctf-competitions" class="text-blue-400 hover:text-blue-300 underline">NCL</a> and <a href="https://ccri-cyberknights.github.io/page/#/resources/ctf-competitions" class="text-blue-400 hover:text-blue-300 underline">NCAE</a>.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap gap-3">
        <a id="calendar-add-google" href="#" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 rounded bg-emerald-500 text-slate-900 font-medium hover:bg-emerald-400 text-sm">Add to Google Calendar</a>
        <a id="calendar-subscribe-link" href="#" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 rounded bg-blue-500 text-slate-900 font-medium hover:bg-blue-400 text-sm">Download .ics</a>
      </div>

      <div class="rounded-lg overflow-hidden border border-slate-800 bg-slate-900/40">
        <iframe id="calendar-iframe" src="" title="" width="100%" height="800" frameborder="0" scrolling="auto"></iframe>
      </div>

      
    </section>
  </template>

  <template id="page-resources">
    <section class="space-y-6">
      <div class="p-4 rounded-lg border border-emerald-500/40 bg-emerald-900/10 text-sm mb-6" style="color: var(--neon-surge);">
        <p id="intro-text">Essential tools and competitions for learning cybersecurity‚Äîwhether you're just starting with CTF basics or sharpening your skills in advanced challenges.</p>
      </div>

      <div class="flex flex-wrap gap-2 text-xs">
        <button data-filter="cyberknights" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Cyberknights</button>
        <button data-filter="ccri" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CCRI</button>
        <button data-filter="ctf-competitions" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CTF Competitions</button>
        <button data-filter="ctf-tools" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">CTF & Code Breaking Tools</button>
        <button data-filter="stem" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">STEM Day</button>
        <button data-filter="career" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Career</button>
        <button data-filter="linux" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Linux</button>
        <button data-filter="blog" class="px-2 py-1 rounded border border-slate-700 hover:border-slate-600">Blog Posts</button>
      </div>

      <div class="relative mb-4">
        <input id="resources-search" type="text" placeholder="Search resources‚Ä¶" class="w-full px-3 py-2 rounded bg-slate-800 border border-slate-700 outline-none focus:border-emerald-500 text-slate-200" />
        <div id="search-results-container" class="absolute top-full left-0 right-0 z-10 mt-1 bg-slate-800 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto hidden">
          <div id="search-results" class="p-2"></div>
        </div>
      </div>

      <div id="resources-grid" class="grid sm:grid-cols-2 gap-3"></div>


      <div class="mt-6">
        <a href="#/home" class="neon-surge-link transition-opacity">Back to Club Home</a>
      </div>
    </section>
  </template>

  <template id="page-guides">
    <section class="space-y-6">
      
      <div id="guides-content" class="space-y-6">
        <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"></div>
            <p class="text-slate-400 mt-2">Loading guide...</p>
          </div>
        </div>
      </div>

      <div class="mt-8">
        <a href="#/resources/linux" class="text-emerald-400 hover:text-emerald-300">‚Üê Back to Linux Learner's Guide</a>
        <span class="mx-2">‚Ä¢</span>
        <a href="#/linux" class="text-emerald-400 hover:text-emerald-300">Linux Boot Guide</a>
      </div>
    </section>
  </template>

  <template id="page-map-warwick-4080">
    <section class="space-y-6">
      <h2 class="text-3xl sm:text-4xl font-bold">Campus Map - Room 4080</h2>
      <p class="text-slate-300">Find our new meeting location in the Auditorium (Room 4080).</p>
      
      <div class="rounded-lg overflow-hidden border border-slate-800 bg-slate-900/40">
        <img src="images/maps/map-rm4080-optimized.webp" alt="Campus Map showing Room 4080 location" class="w-full h-auto" />
      </div>
      
      <div class="p-6 rounded-lg border border-slate-800 bg-slate-900/40">
        <h3 class="text-lg font-semibold mb-4">Meeting Location Details</h3>
        <div class="space-y-3 text-slate-300">
          <div class="flex items-start">
            <span class="font-semibold text-white mr-2">üìç</span>
            <div>
              <div class="font-medium">Auditorium (Room 4080)</div>
              <div class="text-sm text-slate-400">CCRI Warwick Campus</div>
            </div>
          </div>
          <div class="flex items-start">
            <span class="font-semibold text-white mr-2">üïí</span>
            <div>
              <div class="font-medium">Meeting Times</div>
              <div class="text-sm text-slate-400">Mondays 5-6pm ('A' meet), Wednesdays 5-6pm ('B' meet) </div>
            </div>
          </div>
          <div class="flex items-start">
            <span class="font-semibold text-white mr-2">‚ÑπÔ∏è</span>
            <div>
              <div class="font-medium">Note</div>
              <div class="text-sm text-slate-400">We've moved to this larger space due to increased interest in our club activities.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6">
        <a href="#/calendar" class="text-emerald-400 hover:text-emerald-300">‚Üê Back to Calendar</a>
      </div>
    </section>
  </template>

  <script>
    const CALENDAR_EMBED_URL = "https://calendar.google.com/calendar/embed?src=Y2NyaWN5YmVya25pZ2h0Y2x1YkBnbWFpbC5jb20&ctz=America/New_York"; // Optional: Google Calendar embed URL
    const CALENDAR_ICS_URL = "https://calendar.google.com/calendar/ical/Y2NyaWN5YmVya25pZ2h0Y2x1YkBnbWFpbC5jb20/public/basic.ics";    // Public Google Calendar ICS URL
    const DOCS_CALENDAR_URL = "https://github.com/CCRI-Cyberknights/page/blob/main/docs/CALENDAR-UPDATING.md";
    const ENABLE_CUSTOM_CALENDAR = false; // Set to true to use ICS-powered list + FullCalendar
    let fcInstance = null;

    // Function to scroll to a section within the page
    function scrollToSection(sectionId) {
      const element = document.getElementById(sectionId);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }



    let routes = {};

    function normalizeHashRouting() {
      // If old query-param links like ?page=calendar are used, rewrite to #/calendar
      const params = new URLSearchParams(window.location.search);
      const legacy = params.get('page');
      if (legacy && !window.location.hash) {
        const clean = window.location.pathname + '#/' + legacy;
        history.replaceState(null, '', clean);
      }
    }

    // Update navigation active state
    function updateNavigationActiveState(currentPage) {
      const navLinks = document.querySelectorAll('nav a[data-route]');
      navLinks.forEach(link => {
        const route = link.getAttribute('data-route');
        if (route === currentPage) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
    }

    async function render() {
      const raw = (location.hash || '').replace(/^#\/?/, '');
      const [pageName, ...segments] = raw.split('/');
      const page = pageName || 'home';
      
      // Check for nested routes like 'resources/linux'
      const fullRoute = segments.length > 0 ? `${pageName}/${segments[0]}` : pageName;
      
      // Update navigation active state
      updateNavigationActiveState(page);
      
      // Close QR panel when navigating to different pages
      const qrPanel = document.getElementById('footer-qr-panel');
      if (qrPanel && !qrPanel.classList.contains('hidden')) {
        qrPanel.classList.add('hidden');
      }
      
      const app = document.getElementById('app');

      // Handle guide pages (e.g., #/guides/linux-cheatsheet-1.html)
      // Also handle legacy document routes for backward compatibility
      if ((page === 'guides' || page === 'document') && segments.length > 0) {
        // Use the guides template
        app.innerHTML = routes['guides'];


        // Build file path (e.g. guides/linux-cheatsheet-1.html)
        const filePath = 'guides/' + segments.join('/');

        try {
          const res = await fetch(filePath);
          const text = await res.text();
          const bodyMatch = text.match(/<body[^>]*>([\s\S]*)<\/body>/i);
          const content = bodyMatch ? bodyMatch[1] : text;

          document.getElementById('guides-content').innerHTML = content;
        } catch (err) {
          document.getElementById('guides-content').innerHTML =
            `<p class="text-red-400">Failed to load ${filePath}</p>`;
        }
        return;
      }

      // Handle blog pages (e.g., #/blogs/microsoft-aws-ai-opportunities.html)
      if (page === 'blogs' && segments.length > 0) {
        // Use the guides template (same structure as guides)
        app.innerHTML = routes['guides'];

        // Build file path (e.g. blogs/microsoft-aws-ai-opportunities.html)
        const filePath = 'blogs/' + segments.join('/');

        try {
          const res = await fetch(filePath);
          const text = await res.text();
          const bodyMatch = text.match(/<body[^>]*>([\s\S]*)<\/body>/i);
          const content = bodyMatch ? bodyMatch[1] : text;

          document.getElementById('guides-content').innerHTML = content;
        } catch (err) {
          document.getElementById('guides-content').innerHTML =
            `<p class="text-red-400">Failed to load ${filePath}</p>`;
        }
        return;
      }

      // Fallback to normal routes
      let html;
      html = routes[fullRoute] || routes[page] || routes.home;
      app.innerHTML = html;
      // Mobile nav removed - using direct navigation
      if (page === 'calendar') {
        const iframe = document.getElementById('calendar-iframe');
        const callout = document.getElementById('calendar-callout');
        const directLink = document.getElementById('calendar-direct-link');
        const subscribeLink = document.getElementById('calendar-subscribe-link');
        const addGoogleLink = document.getElementById('calendar-add-google');
        if (CALENDAR_EMBED_URL && iframe) {
          iframe.src = CALENDAR_EMBED_URL;
          if (callout) callout.style.display = 'none';
          if (directLink) directLink.href = CALENDAR_EMBED_URL;
        }

        // Always show the green "Add to Your Google Calendar" button when an ICS is configured
        if (subscribeLink) {
          if (CALENDAR_ICS_URL) {
            const webcalUrl = CALENDAR_ICS_URL.replace(/^https?:\/\//, 'webcal://');
            subscribeLink.href = webcalUrl;
            subscribeLink.style.display = '';
          } else {
            subscribeLink.style.display = 'none';
          }
        }

        if (addGoogleLink) {
          const calendarId = 'Y2NyaWN5YmVya25pZ2h0Y2x1YkBnbWFpbC5jb20';
          addGoogleLink.href = 'https://calendar.google.com/calendar/u/0/r?cid=' + calendarId;
        }

        if (ENABLE_CUSTOM_CALENDAR && CALENDAR_ICS_URL) {
          fetchAndRenderEvents(CALENDAR_ICS_URL);
          fetchAndRenderFullCalendar(CALENDAR_ICS_URL);
        }

        if (callout) {
          if (!CALENDAR_EMBED_URL || (ENABLE_CUSTOM_CALENDAR && !CALENDAR_ICS_URL)) {
            callout.innerHTML = 'Maintainers: <a href="' + DOCS_CALENDAR_URL + '" target="_blank" rel="noopener noreferrer" class="underline">see docs</a>.';
          } else {
            callout.style.display = 'none';
          }
        }

        

        if (!ENABLE_CUSTOM_CALENDAR) {
          const nextSection = document.getElementById('next-event');
          const upcomingSection = document.getElementById('upcoming-events-section');
          const fc = document.getElementById('fc-container');
          if (nextSection) nextSection.style.display = 'none';
          if (upcomingSection) upcomingSection.style.display = 'none';
          if (fc) fc.style.display = 'none';
        }
      }
      updateFooterQr(page);
      if (page === 'resources') {
        try { await renderResourcesPage(segments[0] || 'all'); } catch {}
      }
      if (page === 'blog') {
        try { renderBlogPage(); } catch {}
      }
      // Handle individual blog post routes: #/blog/post-slug
      if (page === 'blog' && segments.length > 0) {
        try { renderBlogPost(segments[0]); } catch {}
      }
    }

    function unfoldIcsLines(icsText) {
      const rawLines = icsText.replace(/\r/g, '').split('\n');
      const lines = [];
      for (const line of rawLines) {
        if (!line) continue;
        if (line.startsWith(' ') || line.startsWith('\t')) {
          lines[lines.length - 1] += line.slice(1);
        } else {
          lines.push(line);
        }
      }
      return lines;
    }

    function parseIcsDate(value) {
      // Supports YYYYMMDD and YYYYMMDDTHHMMSSZ or local time without Z
      if (!value) return null;
      const dateOnly = /^\d{8}$/;
      const dateTime = /(\d{8})T(\d{6})(Z?)/;
      if (dateOnly.test(value)) {
        const y = value.slice(0,4), m = value.slice(4,6), d = value.slice(6,8);
        return new Date(`${y}-${m}-${d}T00:00:00`);
      }
      const m = value.match(dateTime);
      if (m) {
        const ymd = m[1];
        const hms = m[2];
        const z = m[3] === 'Z' ? 'Z' : '';
        const y = ymd.slice(0,4), mo = ymd.slice(4,6), d = ymd.slice(6,8);
        const hh = hms.slice(0,2), mm = hms.slice(2,4), ss = hms.slice(4,6);
        return new Date(`${y}-${mo}-${d}T${hh}:${mm}:${ss}${z}`);
      }
      return new Date(value);
    }

    function parseIcs(icsText) {
      const lines = unfoldIcsLines(icsText);
      const events = [];
      let current = null;
      let rrule = null;
      for (const line of lines) {
        if (line === 'BEGIN:VEVENT') { current = {}; rrule = null; continue; }
        if (line === 'END:VEVENT') {
          if (current) {
            if (rrule) current.rrule = rrule;
            events.push(current);
            current = null;
            rrule = null;
          }
          continue;
        }
        if (!current) continue;
        const idx = line.indexOf(':');
        if (idx === -1) continue;
        const nameAndParams = line.slice(0, idx);
        const value = line.slice(idx + 1);
        const prop = nameAndParams.split(';')[0].toUpperCase();
        switch (prop) {
          case 'DTSTART': current.start = parseIcsDate(value); break;
          case 'DTEND': current.end = parseIcsDate(value); break;
          case 'SUMMARY': current.title = value; break;
          case 'DESCRIPTION': current.description = value; break;
          case 'LOCATION': current.location = value; break;
          case 'URL': current.url = value; break;
          case 'RRULE': rrule = value; break;
        }
      }
      return events.filter(e => e.start instanceof Date && !isNaN(e.start));
    }

    function formatDateRange(start, end) {
      const sameDay = end && start.toDateString() === end.toDateString();
      const dateFmt = new Intl.DateTimeFormat(undefined, { weekday: 'short', month: 'short', day: 'numeric' });
      const timeFmt = new Intl.DateTimeFormat(undefined, { hour: 'numeric', minute: '2-digit' });
      const dateStr = dateFmt.format(start);
      if (!end) return `${dateStr} ‚Ä¢ ${timeFmt.format(start)}`;
      if (sameDay) return `${dateStr} ‚Ä¢ ${timeFmt.format(start)} ‚Äì ${timeFmt.format(end)}`;
      return `${dateStr} ${timeFmt.format(start)} ‚Üí ${dateFmt.format(end)} ${timeFmt.format(end)}`;
    }

    function classifyEvent(e) {
      const title = (e.title || '').toLowerCase();
      const isWeekly = e.rrule && /FREQ=WEEKLY/i.test(e.rrule);
      const isRegularByTitle = /(meeting|hang|weekly)/i.test(title);
      return (isWeekly || isRegularByTitle) ? 'regular' : 'special';
    }

    function buildIcsForEvent(e) {
      const pad = (n) => String(n).padStart(2, '0');
      const toIcsDate = (d) => `${d.getUTCFullYear()}${pad(d.getUTCMonth()+1)}${pad(d.getUTCDate())}T${pad(d.getUTCHours())}${pad(d.getUTCMinutes())}${pad(d.getUTCSeconds())}Z`;
      const dtstart = toIcsDate(e.start);
      const dtend = e.end ? toIcsDate(e.end) : toIcsDate(new Date(e.start.getTime() + 60*60*1000));
      const summary = (e.title || 'Event').replace(/\n/g, ' ');
      const description = (e.description || '').replace(/\n/g, ' ');
      const location = (e.location || '').replace(/\n/g, ' ');
      const uid = `${dtstart}-${summary.replace(/[^A-Za-z0-9]+/g,'-')}@ccri-cyberclub`;
      const lines = [
        'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//CCRI Cyber Club//EN','BEGIN:VEVENT',
        `UID:${uid}`,`DTSTAMP:${toIcsDate(new Date())}`,`DTSTART:${dtstart}`,`DTEND:${dtend}`,
        `SUMMARY:${summary}`, description ? `DESCRIPTION:${description}` : '', location ? `LOCATION:${location}` : '', 'END:VEVENT','END:VCALENDAR'
      ].filter(Boolean);
      return 'data:text/calendar;charset=utf-8,' + encodeURIComponent(lines.join('\n'));
    }

    function googleCalendarLink(e) {
      const fmt = (d) => d.toISOString().replace(/[-:]|\.\d{3}/g,'');
      const dates = e.end ? `${fmt(e.start)}/${fmt(e.end)}` : `${fmt(e.start)}`;
      const params = new URLSearchParams({
        action: 'TEMPLATE',
        text: e.title || 'Event',
        dates,
        details: e.description || '',
        location: e.location || ''
      });
      return `https://www.google.com/calendar/render?${params.toString()}`;
    }

    function renderEvents(events) {
      const now = new Date();
      const expanded = expandRecurring(events, now);
      const upcoming = expanded.filter(e => e.end ? e.end >= now : e.start >= now)
                               .sort((a,b) => a.start - b.start);
      const nextContainer = document.getElementById('next-event');
      const nextCard = document.getElementById('next-event-card');
      const list = document.getElementById('events-list');
      const empty = document.getElementById('events-empty');
      if (!list) return;
      list.innerHTML = '';
      if (upcoming.length === 0) {
        if (empty) empty.classList.remove('hidden');
        return;
      }
      if (empty) empty.classList.add('hidden');

      const [nextEvent, ...rest] = upcoming;
      if (nextContainer && nextCard && nextEvent) {
        nextContainer.classList.remove('hidden');
        nextCard.innerHTML = `
          <div class="flex items-start gap-4">
            <div class="flex-shrink-0 text-emerald-300 font-semibold">${new Intl.DateTimeFormat(undefined, {month:'short'}).format(nextEvent.start)}<div class="text-2xl leading-none">${nextEvent.start.getDate()}</div></div>
            <div class="space-y-1">
              <div class="text-lg font-semibold">${nextEvent.title || 'Untitled Event'}</div>
              <div class="text-slate-300 text-sm">${formatDateRange(nextEvent.start, nextEvent.end)}</div>
              ${nextEvent.location ? `<div class="text-slate-400 text-sm">${nextEvent.location}</div>` : ''}
              <div class="pt-3 flex flex-wrap gap-3 items-center">
                ${nextEvent.url ? `<a href="${nextEvent.url}" target="_blank" rel="noopener noreferrer" class="text-emerald-400 hover:text-emerald-300 text-sm">Details</a>` : ''}
                <a href="${buildIcsForEvent(nextEvent)}" download="event.ics" class="px-3 py-1.5 rounded border border-slate-700 hover:border-slate-600 text-xs">Add to Calendar (ICS)</a>
                <a href="${googleCalendarLink(nextEvent)}" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 rounded bg-emerald-500 text-slate-900 font-medium hover:bg-emerald-400 text-xs">Add to Google</a>
                <span class="ml-2 text-[10px] uppercase tracking-wide ${classifyEvent(nextEvent)==='regular' ? 'text-sky-300' : 'text-fuchsia-300'}">${classifyEvent(nextEvent)}</span>
              </div>
            </div>
          </div>`;
      }

      for (const e of rest.slice(0, 10)) {
        const item = document.createElement('div');
        item.className = 'p-4 rounded-lg border border-slate-800 bg-slate-900/40';
        item.innerHTML = `
          <div class="flex items-start gap-4">
            <div class="flex-shrink-0 text-emerald-300 font-medium">${new Intl.DateTimeFormat(undefined, {month:'short'}).format(e.start)}<div class="text-xl leading-none">${e.start.getDate()}</div></div>
            <div class="space-y-1">
              <div class="font-semibold">${e.title || 'Untitled Event'}</div>
              <div class="text-slate-300 text-sm">${formatDateRange(e.start, e.end)}</div>
              ${e.location ? `<div class="text-slate-400 text-sm">${e.location}</div>` : ''}
              <div class="pt-2 flex flex-wrap gap-3 items-center">
                ${e.url ? `<a href="${e.url}" target="_blank" rel="noopener noreferrer" class="text-emerald-400 hover:text-emerald-300 text-sm">Details</a>` : ''}
                <a href="${buildIcsForEvent(e)}" download="event.ics" class="px-3 py-1 rounded border border-slate-700 hover:border-slate-600 text-xs">ICS</a>
                <a href="${googleCalendarLink(e)}" target="_blank" rel="noopener noreferrer" class="px-3 py-1 rounded bg-emerald-500 text-slate-900 font-medium hover:bg-emerald-400 text-xs">Google</a>
                <span class="ml-2 text-[10px] uppercase tracking-wide ${classifyEvent(e)==='regular' ? 'text-sky-300' : 'text-fuchsia-300'}">${classifyEvent(e)}</span>
              </div>
            </div>
          </div>`;
        list.appendChild(item);
      }
    }

    function expandRecurring(events, now) {
      // Minimal weekly RRULE expansion for the next ~90 days
      const horizonMs = 90 * 24 * 60 * 60 * 1000;
      const horizon = new Date(now.getTime() + horizonMs);
      const out = [];
      for (const e of events) {
        if (e.rrule && /FREQ=WEEKLY/i.test(e.rrule)) {
          const intervalMatch = e.rrule.match(/INTERVAL=(\d+)/i);
          const interval = intervalMatch ? parseInt(intervalMatch[1], 10) : 1;
          const bydayMatch = e.rrule.match(/BYDAY=([A-Z,]+)/i);
          const days = bydayMatch ? bydayMatch[1].split(',') : [];
          const baseDow = e.start.getUTCDay();
          const map = {SU:0, MO:1, TU:2, WE:3, TH:4, FR:5, SA:6};
          const start = new Date(e.start);
          let cursor = new Date(start);
          // generate weeks
          while (cursor <= horizon) {
            const occurrences = days.length ? days.map(code => map[code]).filter(d=>d!=null) : [baseDow];
            for (const dow of occurrences) {
              const occ = new Date(Date.UTC(cursor.getUTCFullYear(), cursor.getUTCMonth(), cursor.getUTCDate()));
              const delta = (dow - occ.getUTCDay() + 7) % 7;
              occ.setUTCDate(occ.getUTCDate() + delta);
              const occStart = new Date(occ);
              occStart.setUTCHours(e.start.getUTCHours(), e.start.getUTCMinutes(), e.start.getUTCSeconds(), 0);
              const duration = e.end ? (e.end - e.start) : 60*60*1000;
              const occEnd = new Date(occStart.getTime() + duration);
              if (occEnd >= now && occStart <= horizon) {
                out.push({...e, start: new Date(occStart), end: new Date(occEnd)});
              }
            }
            cursor.setUTCDate(cursor.getUTCDate() + 7 * interval);
          }
        } else {
          out.push(e);
        }
      }
      return out;
    }

    async function fetchAndRenderEvents(icsUrl) {
      try {
        let text = '';
        let res = await fetch(icsUrl, { cache: 'no-store' });
        if (!res.ok) {
          throw new Error('Primary fetch failed');
        }
        text = await res.text();
        const events = parseIcs(text);
        renderEvents(events);
      } catch (err) {
        console.warn('ICS fetch failed, trying CORS proxy', err);
        try {
          const proxied = 'https://r.jina.ai/http://'+ icsUrl.replace(/^https?:\/\//,'');
          const res2 = await fetch(proxied, { cache: 'no-store' });
          if (!res2.ok) throw new Error('Proxy fetch failed');
          const text2 = await res2.text();
          const events2 = parseIcs(text2);
          renderEvents(events2);
        } catch (err2) {
          console.warn('ICS proxy fetch/parse failed', err2);
        }
      }
    }

    async function fetchAndRenderFullCalendar(icsUrl) {
      try {
        let text = '';
        let res = await fetch(icsUrl, { cache: 'no-store' });
        if (!res.ok) throw new Error('Primary fetch failed');
        text = await res.text();
        renderFullCalendarFromIcs(text);
      } catch (err) {
        try {
          const proxied = 'https://r.jina.ai/http://' + icsUrl.replace(/^https?:\/\//, '');
          const res2 = await fetch(proxied, { cache: 'no-store' });
          if (!res2.ok) throw new Error('Proxy fetch failed');
          const text2 = await res2.text();
          renderFullCalendarFromIcs(text2);
        } catch (e) {
          console.warn('FullCalendar ICS load failed', e);
        }
      }
    }

    function renderFullCalendarFromIcs(icsText) {
      const events = parseIcs(icsText);
      const expanded = expandRecurring(events, new Date());
      const fcEvents = expanded.map(e => ({
        title: e.title || 'Event',
        start: e.start,
        end: e.end,
        url: e.url || undefined
      }));
      const el = document.getElementById('fullcalendar');
      if (!el || !window.FullCalendar) return;
      if (fcInstance) { fcInstance.destroy(); fcInstance = null; }
      fcInstance = new FullCalendar.Calendar(el, {
        initialView: 'dayGridMonth',
        height: 'auto',
        themeSystem: 'standard',
        eventClick: (info) => {
          if (info.event.url) { info.jsEvent.preventDefault(); window.open(info.event.url, '_blank', 'noopener'); }
        },
        events: fcEvents
      });
      fcInstance.render();
    }

    function updateFooterQr(page) {
      // Update QR code manager with current URL when navigating between pages
      if (window.qrCodeManager) {
        const currentUrl = window.location.href;
        window.qrCodeManager.url = currentUrl;
        if (window.qrCodeManager.input) {
          window.qrCodeManager.input.value = currentUrl;
        }
        window.qrCodeManager.render(currentUrl);
      }
    }

    // QR Code functionality is now handled by qr-code-manager.js

    // Constants (global scope)
    const BASE_URL = 'https://ccri-cyberknights.github.io/page/';

    // Category-specific intro texts (global scope)
    const categoryTexts = {
      'ctf-tools': 'üîß Versatile online tools for cryptanalysis and data manipulation in Capture the Flag (CTF) challenges. These include quipqiup for automatic cipher solving, Boxentriq for identifying and decoding ciphers, and CyberChef as a comprehensive "Swiss Army knife" for encoding, decoding, and analyzing data.',
      'ccri': 'üè´ Institutional support for cybersecurity education. Key links cover cybersecurity and safety resources, additional educational materials, standardized credit awards for prior learning, and detailed pathway guides outlining degrees, certificates, career outlooks, and student services.',
      'career': 'üéØ Professional development in tech and cybersecurity fields. Includes Security Certification Roadmap for progressing from beginner to expert certifications, tools for exploring job roles in areas like cybersecurity and networking, and college-integrated platforms for job searching, resume building, and professional opportunities.',
      'cyberknights': '‚öîÔ∏è Internal resources supporting club activities and community. Features GitHub repository for projects and code, Discord server for discussions, and official student club page for information and involvement.',
      'ctf-competitions': 'üèÜ National-level cybersecurity competitions for skill-building. These include the National Cyber League (NCL) for hands-on challenges and the National Centers of Academic Excellence (NCAE) CyberGames for collegiate defense and offense exercises.',
      'stem': 'üî¨ Resources for STEM-related events, including the 2025 Cyber Game repository on GitHub, designed for interactive cybersecurity activities and take-home challenges.',
      'linux': 'üêß Foundational resources for cybersecurity learners, including a cheat sheet with essential commands for file navigation, permissions, processes, networking, and more, accessible via an internal document link.',
      'blog': 'üìù Updates, announcements, and insights from the CCRI Cyberknights club. Features career opportunities, meeting recaps, member achievements, and educational content to keep the community informed and engaged.'
    };

    async function renderResourcesPage(preselectedFilter) {
      // Load guides and blogs dynamically
      const guides = await loadContent('guides');
      const blogs = await loadContent('blogs');
      
      // Convert guides and blogs to resource format
      const guideResources = guides.map(guide => ({
        name: guide.title,
        url: `#/guides/${guide.file}`,
        cat: guide.category,
        desc: guide.description,
        summary: guide.summary,
        detailedSummary: guide.detailedSummary
      }));
      
      const blogResources = blogs.map(blog => ({
        name: blog.title,
        url: `#/blogs/${blog.file}`,
        cat: 'blog',
        desc: blog.description,
        summary: blog.summary,
        detailedSummary: blog.detailedSummary
      }));
      
      const data = [
        { 
          name: 'quipqiup', 
          url: 'https://www.quipqiup.com/', 
          cat: 'ctf-tools', 
          desc: 'Automatic cipher solver for cryptanalysis',
          summary: 'quipqiup is a fast and automated tool designed to solve simple substitution ciphers, such as cryptoquips and patristocrats, commonly found in newspapers.',
          detailedSummary: 'Developed by Edwin Olson, quipqiup automates the decoding of simple substitution ciphers like cryptoquips (with preserved word boundaries) and patristocrats (without), by allowing users to input cipher text and optional clues such as "G=R QVW=THE," then generating solutions via the "Solve" button, with adjustable solving modes for better results if needed; it draws from a quote compilation by James F Thompson for contextual accuracy. This tool is highly relevant to cybersecurity and CTF challenges, as it aids in breaking basic encryption methods through pattern analysis, providing quick insights into cryptanalysis techniques essential for puzzle-solving and code-breaking exercises in educational or competitive settings.'
        },
        { 
          name: 'Boxentriq', 
          url: 'https://www.boxentriq.com/', 
          cat: 'ctf-tools', 
          desc: 'Boxentriq serves as a comprehensive puzzle toolkit, using statistics or AI/machine learning to identify cipher types from input.',
          summary: 'Boxentriq serves as a comprehensive puzzle toolkit, using statistics or AI/machine learning to identify cipher types from input.',
          detailedSummary: 'Boxentriq is a website offering tools for cipher identification, decoding, and encoding, including classic and modern ciphers, steganography, text processing, and mathematical puzzles, with features like Morse code translation and AI-based cipher analysis. It excels in CTF challenges by providing practical applications for breaking codes and analyzing data, making it an educational resource for cryptography enthusiasts and cybersecurity learners to practice identifying and decoding various encryption methods in real-world puzzle scenarios.'
        },
        { 
          name: 'CyberChef', 
          url: 'https://cyberchef.io/', 
          cat: 'ctf-tools', 
          desc: 'Swiss Army knife for data analysis and encoding',
          summary: 'CyberChef is a web tool designed for performing various data analysis and encoding operations, allowing users to save and load recipes for later use.',
          detailedSummary: 'As a versatile "Swiss Army knife" for data manipulation, CyberChef enables users to build customizable recipes by selecting operations for analysis and encoding, with features to name, save to local storage, and load them via dropdown or paste; it handles tasks like decoding/encoding formats, hashing, and pattern matching. In cybersecurity and CTF contexts, it\'s invaluable for quick data transformations and forensic analysis, supporting complex workflows that mimic real-world cyber operations, such as decrypting messages or inspecting payloads, all within a user-friendly web interface.'
        },
        { 
          name: 'CCRI Cybersecurity & Safety site', 
          url: 'https://www.ccri.edu/its/cybersecurity/', 
          cat: 'ccri',
          summary: 'The CCRI Cyber Safe Awareness Hub aims to educate students, faculty, and staff on cybersecurity best practices through resources, training, and tips to protect the community and its digital environment.',
          detailedSummary: 'Managed by the Information Security Office (ISO), the hub emphasizes shared responsibility for data protection, providing updates on threats like phishing scams targeting DSS students or impersonating staff, and features like Microsoft\'s Quarantined Emails for handling suspicious messages (auto-deleted after 30 days). It offers practical guidelines such as using two-factor authentication, strong passwords, antivirus software, data backups, software updates, and caution on social media, along with reporting protocols and training events. For CCRI students, this resource is crucial for fostering a secure educational environment, directly addressing campus-specific risks and promoting proactive cyber hygiene to support safe learning and collaboration.'
        },
        { 
          name: 'Security Certification Roadmap (Paul Jerimy)', 
          url: 'https://pauljerimy.com/security-certification-roadmap/', 
          cat: 'career', 
          desc: 'Comprehensive roadmap of cybersecurity certifications from beginner to expert level',
          summary: 'The Security Certification Roadmap by Paul Jerimy Media provides a comprehensive visual guide of 481 cybersecurity certifications categorized by difficulty levels and domains, offering a structured path for professional development in cybersecurity.',
          detailedSummary: 'This roadmap aids career progression by mapping certifications to build technical and managerial skills, relevant for roles in ethical hacking, risk management, and cloud security, helping professionals advance systematically.'
        },
        { 
          name: 'CCRI Cybersecurity Resources', 
          url: 'https://www.ccri.edu/comp/cybersecurity/websites.html', 
          cat: 'ccri',
          desc: 'CCRI cybersecurity program overview and curated industry resources',
          summary: 'The CCRI Cybersecurity Resources page introduces the college\'s cybersecurity program while providing curated links to industry resources, certifications, competitions, and safety guides for students, families, and professionals.',
          detailedSummary: 'The Cybersecurity Resources page at the Community College of Rhode Island (CCRI) serves as a central gateway for anyone interested in the college\'s cybersecurity offerings. It presents a concise overview of the program, which emphasizes hands-on training in network defense, ethical hacking, and digital forensics. The page supports prospective and current students with direct contact options and provides access to a wide range of categorized resources. These include certification programs like CompTIA and EC-Council, competition sites like Hack the Box and National CyberWatch Club, and federal resources such as the NSA, CISA, and NIST. The site also includes cybersecurity safety tools for families, like guides for protecting children online and managing home security systems. While it functions as an introductory landing page rather than a full curriculum guide, it plays a strategic role in outreach, career preparation, and public awareness. The blend of technical resources, academic pathways, and community safety content ensures that students, educators, industry professionals, and families all find relevant, practical information in one place.'
        },
        { 
          name: 'CCRI Standardized Credit Awards', 
          url: 'https://www.ccri.edu/priorlearning/creditawards.html', 
          cat: 'ccri',
          desc: 'CCRI credit awards for professional certifications and prior learning',
          summary: 'The CCRI Standardized Credit Awards page helps students earn college credit for certifications like CompTIA A+, Network+, and Security+, saving time and tuition while allowing them to advance more quickly through their degree programs.',
          detailedSummary: 'The CCRI Standardized Credit Awards page serves as a practical tool for students who have already earned professional certifications and want to apply that knowledge toward a degree. Instead of retaking material they\'ve already mastered, students can receive direct academic credit‚Äîsaving time, money, and accelerating their path to graduation. For example, Sarah, a help desk technician with CompTIA A+ certification, skips two 3-credit courses (CNVT 1000 and CNVT 1010), saving roughly $1,800 and immediately progressing to more advanced coursework. Similarly, Mike, a network administrator with CompTIA Network+ and Security+ certifications, bypasses foundational courses like COMI 2033 and COMI 2037, freeing up time to focus on higher-level cybersecurity topics. These credit awards not only benefit individual students but also support CCRI\'s broader goals‚Äîstreamlining enrollment, attracting industry professionals, and maintaining academic consistency through vetted equivalencies. By functioning as a credit conversion chart, the page increases transparency, bridges the gap between industry experience and academic recognition, and demonstrates CCRI\'s commitment to meeting students where they are in their professional journeys.'
        },
        { 
          name: 'CompTIA: Explore Tech Careers', 
          url: 'https://www.comptia.org/en-us/explore-careers/job-roles/?page=1&category=all', 
          cat: 'career', 
          desc: 'Comprehensive information on tech careers spanning cybersecurity, cloud, networking, and more',
          summary: 'Comprehensive information on tech careers spanning cybersecurity, cloud, networking, and more',
          detailedSummary: 'Development & Programming - Building software applications, websites, and system architectures. Design & User Experience - Creating user-centered interfaces and digital product designs. Quality Assurance & Testing - Ensuring software quality and identifying security vulnerabilities. Cybersecurity - Protecting systems, networks, and data from cyber threats. Systems & Infrastructure - Managing networks, servers, and IT system operations. Support & Analysis - Providing technical assistance and evaluating IT systems for improvements.'
        },
        { 
          name: 'CCRI Cyber Pathway', 
          url: 'https://www.ccri.edu/comp/pathways/cyberpathway.html', 
          cat: 'ccri',
          desc: 'Comprehensive guide to CCRI cybersecurity degrees, certificates, career outlook, and student services',
          summary: 'The Cybersecurity Pathways page at CCRI guides students through certificate and degree options that prepare them for cybersecurity careers or transfer to four-year programs, with job data highlighting high demand and strong salaries.',
          detailedSummary: 'The Cybersecurity Pathways page at the Community College of Rhode Island (CCRI) provides students with a clear roadmap to enter or advance within the cybersecurity field. It outlines multiple educational tracks‚Äîincluding the Cyber Defense Certificate, Networking Technician Certificate, and a dual-degree option combining Cybersecurity and Networking Technology. Each pathway is designed to accommodate students at different stages of their academic journey and offers flexibility to either pursue immediate employment or transfer to a four-year institution. The page also highlights current labor market data, showing 928 active cybersecurity professionals in the region, an average salary exceeding $109,000, and dozens of job openings‚Äîunderscoring the relevance and urgency of this career path. By laying out course requirements, outcomes, and advancement options, the page empowers students to make informed decisions about how best to align their education with their long-term goals in a rapidly growing industry.'
        },
        { 
          name: 'Cyberknights GitHub', 
          url: 'https://github.com/CCRI-Cyberknights/', 
          cat: 'cyberknights',
          desc: 'CCRI Cybersecurity Club GitHub organization',
          summary: 'The CCRI Cyber Club uses GitHub to store technical projects, meeting records, and documentation, ensuring long-term continuity and enabling collaborative development across student-led initiatives.',
          detailedSummary: 'GitHub serves as a foundational platform for the CCRI Cybersecurity Club, providing a centralized, version-controlled space for storing technical materials, meeting minutes, and collaborative projects. Its primary role is to preserve institutional memory and maintain organizational continuity, especially as student leadership changes over time. The platform also supports static website generation using GitHub Pages, enabling the club to publish updates and maintain a public presence. By mirroring real-world development workflows, the club\'s use of GitHub gives members valuable experience while strengthening the club\'s infrastructure and transparency.'
        },
        { 
          name: 'Cyberknights Club Discord', 
          url: 'https://discord.com/channels/1159622463647387719/1159622463647387722', 
          cat: 'cyberknights',
          desc: 'CCRI Cybersecurity Club Discord server',
          summary: 'The CyberKnights Club Discord is the CCRI Cybersecurity Club\'s primary platform for communication, collaboration, and community. It\'s where students share resources, ask questions, get support for competitions, and stay connected outside of meetings.',
          detailedSummary: 'The CyberKnights Club Discord is the central hub for the CCRI Cybersecurity Student Club\'s day-to-day communication, resource sharing, and community engagement. Designed to complement in-person meetings, the server allows students to stay connected, support each other, and coordinate activities remotely. It\'s the primary place for sharing announcements, competition resources, and updates‚Äîsuch as NCL training info or club event details‚Äîand members frequently post their progress to encourage one another. The Discord also supports outreach and recruitment efforts, giving new students a direct path to join the club and participate in activities. Officers use the platform to organize volunteers, answer questions, and provide guidance. In addition to active student use, the server helps alumni remain involved, offering insights and job tips to current members.'
        },
        { 
          name: 'NCL Competition', 
          url: 'https://nationalcyberleague.org/competition', 
          cat: 'ctf-competitions',
          desc: 'National Cyber League cybersecurity competition',
          summary: 'The NCL is a CTF competition that helps students develop cybersecurity skills through individual and team challenges, focusing on forensics, exploitation, and Linux.',
          detailedSummary: 'The NCL is a structured CTF event aimed at skill development and career preparation. It includes four stages: the Cyber Gymnasium for foundational training, a Practice Game to hone skills under pressure, an Individual Game for national ranking, and the Team Game where students compete against other institutions. Participants tackle challenges like digital forensics, web exploitation, and traffic analysis. The club offers coaching, hands-on practice, and access to free competition vouchers. Performance in NCL can be a strong addition to a student\'s resume, demonstrating technical expertise valued by employers.'
        },
        { 
          name: 'NCAE CyberGames', 
          url: 'https://ncaecybergames.org/#', 
          cat: 'ctf-competitions',
          desc: 'National Centers of Academic Excellence CyberGames competition',
          summary: 'The NCAE is a regional cyber defense competition where teams defend pre-compromised systems against active attacks from a red team.',
          detailedSummary: 'The NCAE is a regional, all-day event where teams must defend compromised systems from continuous red team attacks. Participants are tasked with securing various services on systems running Linux, focusing on uptime and service availability. The competition tests students\' ability to think on their feet and respond to real-time security threats. CCRI\'s Cyber Club supports preparation through free NCAE resources, including tutorials and practice sessions. The event is critical for building defensive cybersecurity skills, particularly under pressure, and serves as a key opportunity for students to apply classroom knowledge in a high-stakes, real-world scenario.'
        },
        { 
          name: 'CCRI Cybersecurity Student Club', 
          url: 'https://www.ccri.edu/comp/cybersecurity/studentclub-1.html', 
          cat: 'cyberknights',
          desc: 'Official CCRI cybersecurity student club page',
          summary: 'Official page of CCRI\'s Cybersecurity Student Club, which provides educational and social activities for cybersecurity students including regular meetings, competitions, and networking opportunities.',
          detailedSummary: 'The CCRI Cybersecurity Student Club serves as a dynamic hub for students pursuing cybersecurity, offering opportunities for academic, professional, and personal growth. Open to all students, the club provides a supportive community through meetings, competitions, and networking events. Members can engage in national cybersecurity competitions like the NCL and NCAE, gain hands-on experience, and connect coursework with real-world cyber activities. The club also serves as an informational and communication center, centralizing meeting schedules, officer contacts, and event details. By being an active member of the National Cybersecurity Student Association, the club enhances both the student experience and CCRI\'s reputation. Additionally, it plays a vital role in recruitment and student retention, promoting engagement both in-person and remotely.'
        },
        { 
          name: 'STEM Day 2025 Cyber Game', 
          url: 'https://github.com/CCRI-Cyberknights/stemday_takehome.git', 
          cat: 'stem',
          desc: 'A Capture The Flag (CTF) cybersecurity challenge from CCRI CyberKnights, adapted for home use from their STEM Day event.',
          summary: 'A Capture The Flag (CTF) cybersecurity challenge from CCRI CyberKnights, adapted for home use from their STEM Day event.',
          detailedSummary: 'A Capture The Flag (CTF) cybersecurity challenge from CCRI CyberKnights, adapted for home use from their STEM Day event.'
        },
        { 
          name: 'Handshake', 
          url: 'https://ccri.joinhandshake.com/login', 
          cat: 'career', 
          desc: 'College-integrated career platform for job seeking and professional development',
          summary: 'Handshake is a college-integrated career platform that allows CCRI students to search for jobs, internships, and events, apply online, explore career paths, and connect with employers through a user-friendly dashboard.',
          detailedSummary: 'Integrated with CCRI for seamless access via school SSO, Handshake enables profile creation, resume uploads (with preferred templates highlighting skills prominently), job/internship searches (including on-campus like Academic Computer Lab), virtual event attendance, and direct employer messaging; it\'s free for students and employers, with data tracking for career centers. For professional development, it supports resume reviews, mock interviews, and networking with nearly 1 million employers, making it vital for CCRI students transitioning to cybersecurity careers by providing real opportunities and advice.'
        },
        ...guideResources,
        ...blogResources
      ];

      const grid = document.getElementById('resources-grid');
      const search = document.getElementById('resources-search');
      const filterButtons = Array.from(document.querySelectorAll('[data-filter]'));
      const catNames = { 'ctf-tools': 'CTF & Code Breaking Tools', 'ctf-competitions': 'CTF Competitions', 'ccri': 'CCRI', 'cyberknights': 'Cyberknights', 'stem': 'STEM Day', 'linux': 'Linux', 'career': 'Career', 'blog': 'Blog Posts' };
      const availableFilters = new Set(filterButtons.map(b => b.dataset.filter));
      const initialFilter = (preselectedFilter && availableFilters.has(preselectedFilter)) ? preselectedFilter : 'cyberknights';

      function setActive(filter) {
        filterButtons.forEach(b => b.classList.remove('ring-1','ring-emerald-500'));
        const target = filterButtons.find(b => b.dataset.filter === filter) || filterButtons.find(b => b.dataset.filter === 'cyberknights');
        if (target) target.classList.add('ring-1','ring-emerald-500');
      }

      // Function to determine button text based on resource type
      function getButtonText(resourceName) {
        const name = resourceName.toLowerCase();
        if (name.includes('github')) {
          return 'View Repository';
        } else if (name.includes('discord')) {
          return 'Visit Site';
        } else if (name.includes('handshake')) {
          return 'Access Handshake';
        } else if (name.includes('cheat sheet') || name.includes('cheatsheet') || name.includes('getting started')) {
          return 'View';
        } else if (name.includes('competition') || name.includes('ncl') || name.includes('cybergames')) {
          return 'Join Competition';
        }
        return 'Visit Site';
      }

      // Function to get category label
      function getCategoryLabel(category) {
        return catNames[category] || category;
      }

      // Constants are now defined in global scope

      // CSS class generators for DRY
      function getEmeraldLinkClasses() {
        return 'neon-surge-link transition-opacity';
      }

      function getCalendarButtonClasses() {
        return 'px-3 py-1 rounded bg-emerald-500 text-slate-900 font-medium hover:bg-emerald-400';
      }

      function getExternalLinkAttributes(url) {
        // Only add external link attributes for external URLs
        if (url && !url.startsWith('#/guides/') && !url.startsWith('#/document/')) {
          return 'target="_blank" rel="noopener noreferrer"';
        }
        return '';
      }

      // SVG icon generators for DRY
      function getExternalLinkIcon() {
        return `<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                </svg>`;
      }

      function getDocumentIcon() {
        return `<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>`;
      }

      function getLinkIcon(url) {
        // Check if it's a local guide (starts with #/guides/ or legacy #/document/)
        if (url.startsWith('#/guides/') || url.startsWith('#/document/')) {
          return getDocumentIcon();
        }
        return getExternalLinkIcon();
      }

      function getCloseIcon() {
        return `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>`;
      }

      function renderLists(items) {
        if (grid) {
          grid.innerHTML = '';
          for (const r of items) {
            const catLabel = getCategoryLabel(r.cat);
            const card = document.createElement('div');
            
            // Apply different styling based on content type
            let cardClasses = 'block p-3 rounded border border-slate-800 bg-slate-900/60 transition-colors cursor-pointer';
            if (r.cat === 'blog') {
              // Blog posts: warm accent (amber/orange)
              cardClasses += ' hover:border-amber-500';
            } else if (r.cat === 'linux' || r.cat === 'career') {
              // Guides: cool accent (blue)
              cardClasses += ' hover:border-blue-500';
            } else {
              // Default: emerald accent
              cardClasses += ' hover:border-emerald-600';
            }
            
            card.className = cardClasses;
            card.onclick = () => openResourceModal(r);
            
            // Resource name and category
            const header = document.createElement('div');
            header.className = 'mb-2';
            header.innerHTML = `
              <div class="text-sm font-medium text-slate-100">${r.name}</div>
              <div class="text-[11px] text-slate-400">${catLabel}</div>
            `;
            
            // Summary (hidden when expanded)
            const summary = document.createElement('div');
            summary.className = 'summary-text text-[12px] text-slate-300 mt-2 mb-3';
            summary.textContent = r.summary || r.desc || '';
            
            
            // Action button
            const actionButton = document.createElement('div');
            actionButton.className = 'flex justify-end';
            
            const buttonText = getButtonText(r.name);
            
            actionButton.innerHTML = `
              <a href="${r.url}" ${getExternalLinkAttributes(r.url)} 
                 class="inline-flex items-center gap-1 px-3 py-1 text-[12px] bg-emerald-600 hover:bg-emerald-700 text-white rounded transition-colors"
                 onclick="event.stopPropagation()">
                <span>${buttonText}</span>
                ${getLinkIcon(r.url)}
              </a>
            `;
            
            card.innerHTML = `
              ${header.outerHTML}
              ${summary.outerHTML}
              ${actionButton.outerHTML}
            `;
            
            grid.appendChild(card);
          }
        }
      }
      
      // Function to format detailed summary with bullet points
      function formatDetailedSummary(text) {
        if (!text) return '';
        
        // Split by periods and filter out empty strings
        const sentences = text.split('.').filter(s => s.trim().length > 0);
        
        // Create bullet points
        return sentences.map(sentence => {
          const trimmed = sentence.trim();
          return `<li>${trimmed}${trimmed.endsWith('.') ? '' : '.'}</li>`;
        }).join('');
      }

      // Function to open resource modal (now uses expandElement system)
      window.openResourceModal = function(resource) {
        const buttonText = getButtonText(resource.name);
        const catLabel = getCategoryLabel(resource.cat);
        
        // Create a temporary element to expand
        const tempElement = document.createElement('div');
        tempElement.className = 'resource-modal-content';
        tempElement.innerHTML = `
          <div class="p-6 max-w-2xl">
            <h3 class="text-xl font-bold text-slate-100 mb-4">${resource.name}</h3>
            <div class="text-sm text-slate-400 mb-4">${catLabel}</div>
            ${resource.detailedSummary ? `
              <div class="text-slate-300 leading-relaxed mb-6">
                <ul class="list-disc list-inside space-y-2">
                  ${formatDetailedSummary(resource.detailedSummary)}
                </ul>
              </div>
            ` : ''}
            <div class="flex justify-end">
              <a href="${resource.url}" ${getExternalLinkAttributes(resource.url)} 
                 class="inline-flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded transition-colors">
                <span>${buttonText}</span>
                ${getLinkIcon(resource.url)}
              </a>
            </div>
          </div>
        `;
        
        // Use the new expandElement system
        expandElement(tempElement, { 
          type: 'html',
          maxWidth: '90vw',
          maxHeight: '90vh'
        });
      };
      
      
      
      // Function to toggle detailed summaries
      window.toggleDetails = function(element) {
        const detailedSummary = element.nextElementSibling;
        if (detailedSummary) {
          detailedSummary.classList.toggle('hidden');
          const moreText = element.querySelector('span');
          moreText.textContent = detailedSummary.classList.contains('hidden') ? 'more' : 'less';
        }
      };

      function applyFilters() {
        const q = (search && search.value || '').toLowerCase();
        const active = filterButtons.find(b => b.classList.contains('ring-1'))?.dataset.filter || 'cyberknights';
        let items = data.slice();
        
        // If there's a search query, search across all resources regardless of category
        if (q) {
          items = items.filter(r => {
            const catLabel = getCategoryLabel(r.cat).toLowerCase();
            return r.name.toLowerCase().includes(q) || r.url.toLowerCase().includes(q) || catLabel.includes(q);
          });
          showSearchResults(items, q);
        } else {
          // If no search query, filter by active category
          items = items.filter(r => r.cat === active);
          hideSearchResults();
        }
        
        renderLists(items);
      }
      
      function showSearchResults(items, query) {
        const container = document.getElementById('search-results-container');
        const results = document.getElementById('search-results');
        
        if (!container || !results) return;
        
        if (items.length === 0) {
          results.innerHTML = '<div class="text-slate-400 text-sm p-2">No resources found</div>';
        } else {
          results.innerHTML = items.slice(0, 5).map(r => `
            <div class="p-2 hover:bg-slate-700 cursor-pointer rounded" onclick="selectSearchResult('${r.name}')">
              <div class="text-sm text-slate-200">${r.name}</div>
              <div class="text-xs text-slate-400">${getCategoryLabel(r.cat)}</div>
            </div>
          `).join('');
        }
        
        container.classList.remove('hidden');
      }
      
      function hideSearchResults() {
        const container = document.getElementById('search-results-container');
        if (container) {
          container.classList.add('hidden');
        }
      }
      
      function selectSearchResult(resourceName) {
        const resource = data.find(r => r.name === resourceName);
        if (resource) {
          openResourceModal(resource);
          hideSearchResults();
          if (search) search.value = '';
        }
      }
      
      
      // Make functions globally available
      window.selectSearchResult = selectSearchResult;
      window.hideSearchResults = hideSearchResults;

      filterButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const filter = btn.dataset.filter || 'all';
          
          // Option 3: Change hash first, then smooth CSS transition
          if (filter === 'all') {
            location.hash = '#/resources';
          } else {
            location.hash = '#/resources/' + filter;
          }
          
          // Wait for re-render, then apply smooth transition
          setTimeout(() => {
            const introText = document.getElementById('intro-text');
            if (introText && categoryTexts[filter]) {
              // Apply smooth CSS transition
              introText.classList.add('text-change');
              introText.textContent = categoryTexts[filter];
              setTimeout(() => introText.classList.remove('text-change'), 800);
            }
          }, 100); // Small delay to allow re-render
        });
      });
      if (search) {
        search.addEventListener('input', applyFilters);
        search.addEventListener('blur', () => {
          // Delay hiding to allow click on search results
          setTimeout(hideSearchResults, 150);
        });
        search.addEventListener('focus', () => {
          if (search.value.trim()) {
            applyFilters();
          }
        });
      }
      
      // Add click-outside functionality for search results
      document.addEventListener('click', (e) => {
        const searchContainer = document.getElementById('search-results-container');
        const searchInput = document.getElementById('resources-search');
        
        if (searchContainer && !searchContainer.contains(e.target) && 
            searchInput && !searchInput.contains(e.target)) {
          hideSearchResults();
        }
      });
      
      setActive(initialFilter);
      applyFilters();
      
      // Update intro text for preselected filter
      if (preselectedFilter && categoryTexts[preselectedFilter]) {
        const introText = document.getElementById('intro-text');
        if (introText) {
          introText.textContent = categoryTexts[preselectedFilter];
        }
      }
    }

    // DRY Expandable Element System - Clean and Simple
    (function () {
      // Defaults
      const DEFAULTS = {
        maxWidth: '90vw',
        maxHeight: '90vh',
        zoom: 1.6,
        focusSelector: '.expand-close'
      };

      // Helper: create element with attrs
      function el(tag, attrs = {}, children = []) {
        const e = document.createElement(tag);
        Object.entries(attrs).forEach(([k, v]) => {
          if (v === true) e.setAttribute(k, '');
          else if (v !== false && v != null) e.setAttribute(k, v);
        });
        children.forEach(c => e.appendChild(c));
        return e;
      }

      // Basic focus trap
      function trapFocus(container) {
        const focusable = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, [tabindex]:not([tabindex="-1"])';
        const nodes = Array.from(container.querySelectorAll(focusable));
        if (!nodes.length) return () => {};
        let first = nodes[0], last = nodes[nodes.length - 1];
        function handle(e) {
          if (e.key !== 'Tab') return;
          if (e.shiftKey && document.activeElement === first) {
            e.preventDefault();
            last.focus();
          } else if (!e.shiftKey && document.activeElement === last) {
            e.preventDefault();
            first.focus();
          }
        }
        document.addEventListener('keydown', handle);
        return () => document.removeEventListener('keydown', handle);
      }

      // Compute size: respects aspect ratio, natural sizes, and max constraints
      function computeSize(naturalW, naturalH, maxW, maxH) {
        const ratio = naturalW && naturalH ? naturalW / naturalH : 1;
        let width = maxW, height = maxH;

        if (naturalW && naturalH) {
          if (naturalW <= maxW && naturalH <= maxH) {
            width = naturalW; height = naturalH;
          } else {
            if (maxW / ratio <= maxH) {
              width = maxW;
              height = Math.round(maxW / ratio);
            } else {
              height = maxH;
              width = Math.round(maxH * ratio);
            }
          }
        }
        return { width, height };
      }

      // Main API
      window.expandElement = function (trigger, options = {}) {
        if (!trigger || !(trigger instanceof Element)) return;
        const dataset = trigger.dataset || {};
        const opts = {
          type: options.type || dataset.type || detectType(trigger),
          maxWidth: options.maxWidth || dataset.maxWidth || DEFAULTS.maxWidth,
          maxHeight: options.maxHeight || dataset.maxHeight || DEFAULTS.maxHeight,
          zoom: options.zoom || dataset.zoom || DEFAULTS.zoom,
          clone: options.clone == null ? (dataset.clone !== 'false') : options.clone,
          onClose: options.onClose
        };

        // Prevent opening multiple overlays
        if (document.querySelector('.expand-overlay')) return;

        // Create overlay & dialog
        const overlay = el('div', { class: 'expand-overlay', tabindex: '-1' });
        const dialog = el('div', { class: 'expand-dialog', role: 'dialog', 'aria-modal': 'true' });
        dialog.style.setProperty('--expand-max-width', opts.maxWidth);
        dialog.style.setProperty('--expand-max-height', opts.maxHeight);

        const content = el('div', { class: 'expand-content' });
        const closeBtn = el('button', { class: 'expand-close', 'aria-label': 'Close expanded view', type: 'button' });
        closeBtn.textContent = '‚úï';

        // Insert content based on type
        if (opts.type === 'image') {
          let srcEl = trigger;
          if (trigger.tagName.toLowerCase() === 'picture') {
            srcEl = trigger.querySelector('img') || trigger;
          }
          const img = document.createElement('img');
          img.alt = srcEl.alt || srcEl.getAttribute('aria-label') || 'Expanded image';
          img.src = srcEl.src || srcEl.dataset.src || srcEl.getAttribute('src');
          img.loading = 'eager';
          content.appendChild(img);

          // Wait to get natural size to compute exact dialog size
          img.addEventListener('load', () => {
            const maxWpx = Math.min(window.innerWidth * 0.95, parseCssSize(opts.maxWidth, window.innerWidth));
            const maxHpx = Math.min(window.innerHeight * 0.95, parseCssSize(opts.maxHeight, window.innerHeight));
            const { width, height } = computeSize(img.naturalWidth, img.naturalHeight, maxWpx, maxHpx);
            dialog.style.width = width + 'px';
            dialog.style.height = height + 'px';
          });
        } else if (opts.type === 'qr') {
          // For QR, clone and enlarge
          if (trigger.tagName.toLowerCase() === 'img') {
            const img = trigger.cloneNode(true);
            img.alt = trigger.alt || 'QR code';
            img.style.width = 'auto';
            img.style.height = 'auto';
            img.style.maxWidth = '90%';
            img.style.maxHeight = '90%';
            content.appendChild(img);
            // Add metadata area for QR manager
            const meta = el('div', { class: 'expand-qr-meta' });
            meta.textContent = 'QR Manager';
            dialog.appendChild(meta);
          } else {
            const clone = trigger.cloneNode(true);
            content.appendChild(clone);
          }
          dialog.style.width = opts.maxWidth;
          dialog.style.height = opts.maxHeight;
        } else {
          // default: clone node content (HTML)
          const clone = opts.clone ? trigger.cloneNode(true) : trigger;
          sanitizeClonedNodes(clone);
          content.appendChild(clone);
          dialog.style.width = opts.maxWidth;
          dialog.style.height = opts.maxHeight;
        }

        dialog.appendChild(content);
        dialog.appendChild(closeBtn);
        overlay.appendChild(dialog);
        document.body.appendChild(overlay);

        // Accessibility: label dialog
        const label = trigger.getAttribute('aria-label') || trigger.alt || trigger.title || 'Expanded content';
        dialog.setAttribute('aria-label', label);

        // Save focus and set focus to close button
        const previousActive = document.activeElement;
        closeBtn.focus();

        // Prevent background scroll
        const prevOverflow = document.documentElement.style.overflow;
        document.documentElement.style.overflow = 'hidden';

        // Mobile back button support
        const popstateHandler = (e) => { 
          close('mobile-back'); 
        };
        window.addEventListener('popstate', popstateHandler);
        
        // Push a dummy state to enable back button detection
        history.pushState({ modal: true }, '', window.location.href);

        // Event listeners
        function close(reason) {
          if (!overlay.parentNode) return;
          
          // Remove popstate listener
          window.removeEventListener('popstate', popstateHandler);
          
          // Restore history state if we pushed one
          if (history.state && history.state.modal) {
            history.back();
          }
          
          overlay.parentNode.removeChild(overlay);
          document.documentElement.style.overflow = prevOverflow || '';
          if (previousActive && previousActive.focus) previousActive.focus();
          if (offKey) offKey();
          if (opts.onClose) opts.onClose(reason);
        }

        function onOverlayClick(e) {
          if (e.target === overlay) close('overlay');
        }
        overlay.addEventListener('click', onOverlayClick);
        closeBtn.addEventListener('click', () => close('close-button'));

        // ESC handler
        const escHandler = (e) => { if (e.key === 'Escape') close('esc'); };
        document.addEventListener('keydown', escHandler);

        // focus trap
        const offKey = trapFocus(dialog);

        return { close };
      };

      // Utility: detect type from element
      function detectType(node) {
        const tag = node.tagName.toLowerCase();
        const typeAttr = node.dataset && node.dataset.type;
        if (typeAttr) return typeAttr;
        if (tag === 'img' || tag === 'picture') return 'image';
        if (node.classList && node.classList.contains('qr')) return 'qr';
        return 'html';
      }

      // Utility: parse CSS size like '90vw' to px fallback
      function parseCssSize(sizeStr, fallbackBase) {
        if (!sizeStr) return fallbackBase;
        if (sizeStr.endsWith('vw')) {
          return (parseFloat(sizeStr) / 100) * window.innerWidth;
        }
        if (sizeStr.endsWith('vh')) {
          return (parseFloat(sizeStr) / 100) * window.innerHeight;
        }
        if (sizeStr.endsWith('px')) {
          return parseFloat(sizeStr);
        }
        const parsed = parseFloat(sizeStr);
        if (!isNaN(parsed)) return parsed;
        return fallbackBase;
      }

      // Remove duplicate IDs in clones to avoid document-wide ID collisions
      function sanitizeClonedNodes(node) {
        if (!node.querySelectorAll) return;
        const nodesWithId = node.querySelectorAll('[id]');
        nodesWithId.forEach(n => n.removeAttribute('id'));
      }

    })();

    // Unified content loading system for both guides and blogs
    let blogPosts = [];
    let guides = [];

    async function loadContent(type) {
      try {
        // Use different file names for different content types
        const fileName = type === 'blogs' ? 'blog-posts.json' : 'guides.json';
        const response = await fetch(`./${type}/${fileName}`);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const content = await response.json();
        
        if (type === 'blogs') {
          blogPosts = content;
        } else if (type === 'guides') {
          guides = content;
        }
        
        return content;
      } catch (error) {
        console.error(`Failed to load ${type}:`, error);
        if (type === 'blogs') {
          blogPosts = [];
        } else if (type === 'guides') {
          guides = [];
        }
        return [];
      }
    }

    // Legacy function for backward compatibility
    async function loadBlogPosts() {
      return await loadContent('blogs');
    }

    async function renderBlogPage() {
      await loadBlogPosts();
      
      if (blogPosts.length === 0) {
        // Show coming soon if no posts loaded - use the template
        return;
      }

      // Sort posts by date (newest first)
      const sortedPosts = blogPosts.sort((a, b) => new Date(b.date) - new Date(a.date));

      // Find the blog container within the current page
      const blogContainer = document.querySelector('#app section');
      if (!blogContainer) return;

      // Replace the coming soon content with actual blog posts
      const comingSoonCard = blogContainer.querySelector('.p-6.rounded-lg.border.border-slate-800.bg-slate-900\\/40');
      if (comingSoonCard) {
        comingSoonCard.outerHTML = sortedPosts.map(post => createBlogCard(post)).join('');
      }
    }

    function createBlogCard(post) {
      return `
        <article class="p-6 rounded-lg border border-slate-800 bg-slate-900/40 hover:border-emerald-600 transition-colors cursor-pointer" onclick="openBlogPost('${post.slug}')">
          <div class="flex justify-between items-start mb-3">
            <h3 class="text-xl font-semibold text-emerald-400">${post.title}</h3>
            <span class="text-sm text-slate-400">${formatDate(post.date)}</span>
          </div>
          
          <div class="flex items-center gap-2 mb-3">
            <span class="px-2 py-1 rounded bg-slate-700 text-xs text-slate-300">${post.category}</span>
            <span class="text-xs text-slate-400">by ${post.author}</span>
          </div>
          
          <p class="text-slate-300 mb-4">${post.summary}</p>
          
          <div class="flex justify-between items-center">
            <div class="flex gap-1">
              ${post.tags.map(tag => `<span class="px-2 py-1 rounded bg-emerald-900/30 text-xs text-emerald-300">#${tag}</span>`).join('')}
            </div>
            <span class="text-sm text-emerald-400">Read more ‚Üí</span>
          </div>
        </article>
      `;
    }

    async function renderBlogPost(slug) {
      const post = blogPosts.find(p => p.slug === slug);
      if (!post) {
        // Show error message in the current page
        const blogContainer = document.querySelector('#app section');
        if (blogContainer) {
          blogContainer.innerHTML = '<div class="text-center py-8"><h2 class="text-2xl font-bold text-red-400">Post Not Found</h2><p class="text-slate-300 mt-4">The requested blog post could not be found.</p><a href="#/blog" class="inline-flex items-center text-emerald-400 hover:text-emerald-300 mt-4"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>Back to Blog</a></div>';
        }
        return;
      }

      // Load the HTML file content
      try {
        const response = await fetch(`./blogs/${post.file}`);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const htmlContent = await response.text();
        
        // Extract body content from the HTML file
        const bodyMatch = htmlContent.match(/<body[^>]*>([\s\S]*)<\/body>/i);
        const content = bodyMatch ? bodyMatch[1] : htmlContent;
        
        // Replace the blog page content with the loaded HTML
        const blogContainer = document.querySelector('#app section');
        if (!blogContainer) return;
        
        blogContainer.innerHTML = content;
      } catch (error) {
        console.error('Failed to load blog post:', error);
        const blogContainer = document.querySelector('#app section');
        if (blogContainer) {
          blogContainer.innerHTML = '<div class="text-center py-8"><h2 class="text-2xl font-bold text-red-400">Error Loading Post</h2><p class="text-slate-300 mt-4">Failed to load the blog post content.</p><a href="#/blog" class="inline-flex items-center text-emerald-400 hover:text-emerald-300 mt-4"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>Back to Blog</a></div>';
        }
      }
    }

    // Blog post modal (following your existing modal pattern)
    window.openBlogPost = async function(slug) {
      const post = blogPosts.find(p => p.slug === slug);
      if (!post) return;

      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4';
      modal.onclick = (e) => {
        if (e.target === modal) closeBlogModal();
      };

      // Show loading state
      modal.innerHTML = `
        <div class="bg-slate-900 rounded-lg border border-slate-800 max-w-4xl max-h-[90vh] overflow-y-auto">
          <div class="p-6 border-b border-slate-800">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h2 class="text-2xl font-bold text-emerald-400 mb-2">${post.title}</h2>
                <div class="flex items-center gap-4 text-sm text-slate-400">
                  <span>${formatDate(post.date)}</span>
                  <span>by ${post.author}</span>
                  <span class="px-2 py-1 rounded bg-slate-700">${post.category}</span>
                </div>
              </div>
              <button onclick="closeBlogModal()" class="text-slate-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
          </div>
          
          <div class="p-6">
            <div class="text-center text-slate-400">Loading content...</div>
          </div>
          
          <div class="p-6 border-t border-slate-800">
            <div class="flex gap-2 mb-4">
              ${post.tags.map(tag => `<span class="px-2 py-1 rounded bg-emerald-900/30 text-xs text-emerald-300">#${tag}</span>`).join('')}
            </div>
            <button onclick="closeBlogModal()" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded transition-colors">
              Close
            </button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
      document.body.style.overflow = 'hidden';

      // Load the HTML file content
      try {
        const response = await fetch(`./${post.file}`);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const htmlContent = await response.text();
        
        // Extract body content from the HTML file
        const bodyMatch = htmlContent.match(/<body[^>]*>([\s\S]*)<\/body>/i);
        const content = bodyMatch ? bodyMatch[1] : htmlContent;
        
        // Extract just the main content (skip header and footer)
        const mainMatch = content.match(/<main[^>]*>([\s\S]*)<\/main>/i);
        const mainContent = mainMatch ? mainMatch[1] : content;
        
        // Update modal content
        const contentDiv = modal.querySelector('.p-6');
        contentDiv.innerHTML = `<div class="prose prose-invert max-w-none">${mainContent}</div>`;
        
      } catch (error) {
        console.error('Failed to load blog post:', error);
        const contentDiv = modal.querySelector('.p-6');
        contentDiv.innerHTML = '<div class="text-center text-red-400">Failed to load blog post content.</div>';
      }

      // Add keyboard support
      const handleKeydown = (e) => {
        if (e.key === 'Escape') {
          closeBlogModal();
          document.removeEventListener('keydown', handleKeydown);
        }
      };
      document.addEventListener('keydown', handleKeydown);
    };

    window.closeBlogModal = function() {
      const modal = document.querySelector('.fixed.inset-0.bg-black\\/90');
      if (modal) {
        modal.remove();
        document.body.style.overflow = 'auto';
      }
    };

    // Utility function following your existing patterns
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }

    // Generate small QR code for footer
    function generateSmallQRCode() {
      const container = document.getElementById('footer-qr-svg');
      if (!container) {
        console.log('QR SVG container not found');
        return;
      }

      // Check if QRCode library is available (npm package)
      if (typeof QRCode === 'undefined') {
        console.log('QRCode library not loaded');
        return;
      }

      const currentUrl = window.location.href;

      try {
        // Generate SVG QR code
        QRCode.toString(currentUrl, {
          type: 'svg',
          width: 64,
          margin: 1,
          color: {
            dark: '#000000',   // Dark modules (black)
            light: '#ffffff'   // Light modules (white)
          },
          errorCorrectionLevel: 'L'  // Low error correction
        }, function (error, svgString) {
          if (error) {
            console.error('QR Code generation error:', error);
          } else {
            console.log('QR code SVG generated successfully');
            // Insert SVG into container
            container.innerHTML = svgString;
            
            // Add click handler to open QR Code Manager in full screen
            container.style.cursor = 'pointer';
            container.title = 'Click to open QR Code Manager in full screen';
            container.addEventListener('click', function(e) {
              e.stopPropagation(); // Prevent toggle button from opening
              
              // Open the QR Code Manager panel first, then expand it
              if (window.qrCodeManager && window.qrCodeManager.panel) {
                // First open the panel (remove hidden class)
                window.qrCodeManager.panel.classList.remove('hidden');
                
                // Then expand it to full screen
                window.qrCodeManager.expandPanel();
              } else {
                console.warn('QR Code Manager not available');
              }
            });
          }
        });

      } catch (error) {
        console.error('Error generating QR code:', error);
      }
    }

    // No resize handler needed - CSS handles responsiveness automatically with min(80vw, 600px)

    window.addEventListener('hashchange', render);
    window.addEventListener('DOMContentLoaded', () => {
      // Initialize routes object after DOM is ready
      routes = {
        home: document.getElementById('page-home').innerHTML,
        linux: document.getElementById('page-linux').innerHTML,
        calendar: document.getElementById('page-calendar').innerHTML,
        resources: document.getElementById('page-resources') ? document.getElementById('page-resources').innerHTML : '<section class="space-y-6"><h2 class="text-3xl sm:text-4xl font-bold">Resources</h2><p class="text-slate-300">Coming soon.</p></section>',
        blog: document.getElementById('page-blog').innerHTML,
        'map-warwick-4080': document.getElementById('page-map-warwick-4080').innerHTML,
        'guides': document.getElementById('page-guides').innerHTML,
        'document': document.getElementById('page-guides').innerHTML  // Legacy route support
      };
      
      document.getElementById('year').textContent = new Date().getFullYear();
      
      normalizeHashRouting();
      // Mobile navigation removed - using direct navigation
      render();
      
      // Modern Version Display - Dynamically loaded from version.json
      // Version is now managed by version-display.js for single source of truth
      
      // Generate small QR code for footer (with delay to ensure qrcode library is loaded)
      setTimeout(generateSmallQRCode, 100);
    });
  </script>
</body>
</html>


<!-- Test comment for Playwright migration -->
<!-- Another test comment -->
